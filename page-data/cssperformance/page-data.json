{"componentChunkName":"component---src-templates-blog-post-js","path":"/cssperformance/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"435fb7ef-324b-5f63-9814-ab12ab5b4c5e","fields":{"slug":"/2021-02-cssperformance/"},"headings":[{"value":"網頁渲染邏輯","id":null,"depth":2},{"value":"避免使用影響載入","id":null,"depth":2},{"value":"心得","id":null,"depth":2}],"excerpt":"CSS 常被認為簡單好學，我對它看法是易學但難精通，以前都只想過實現各種 UI、效果，但沒認真考慮過效能，怎樣的寫法最適合這個情境。假設你有針對 google page speed、lighthouse…","html":"<p>CSS 常被認為簡單好學，我對它看法是易學但難精通，以前都只想過實現各種 UI、效果，但沒認真考慮過效能，怎樣的寫法最適合這個情境。假設你有針對 google page speed、lighthouse 優化過，應該會特別有感觸，該如何才能讓網頁載入更快。</p>\n<p>接下來討論如何讓畫面渲染載入更快，以及一些最佳化使用方式。</p>\n<h2>網頁渲染邏輯</h2>\n<p>首先介紹最基礎的 painting，瀏覽器的畫面產生，需要有幾個步驟，先是由上至下掃一遍 html，擷取內容後，先產生 HTML DOM tree，再來產生 CSSOM tree，</p>\n<p>經由上面步驟，轉譯樹狀結構，將 兩個 tree 合併起來產生 render tree，最後是關鍵的步驟，根據每個節點，依照 style 決定 layout 版面配置，或是決定樣式套用，並且繪製在畫面上，就是我們看到 div 並帶有 width 等樣式。</p>\n<p><img src=\"../images/domcssom.png\" alt=\"html DOM CSSOM\" title=\"HTMLDOM CSSOM Render Tree (畫圖花了我三十分鐘...)\"></p>\n<p>Google: <a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-tw\" title=\"轉譯樹狀結構的建構、版面配置和繪製\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">轉譯樹狀結構的建構、版面配置和繪製</a></p>\n<p>所謂的優化關鍵路徑，就是要縮短這整個流程的時間，擷取 HTML -> DOM tree -> CSSOM tree -> render tree -> painting。</p>\n<h2>避免使用影響載入</h2>\n<p>網頁載入速度快慢影響，首先是資源請求速度，網頁上的 CSS JS file 都會是需要發 http 請求的，遇到這狀況時，解析器都必須先停止解析 HTML 並執行該腳本，然後才能繼續解析。所以盡可能避免過多個資源請求，讓 css 或是 js print 到 html 上。</p>\n<p>針對 script file 推薦用 async 或是 defer，async 是不中斷 HTML parser 並當載入 js file 完成立刻執行，defer 則是當整體 HTML parser 完成，再回頭執行 js file。小提醒 async 代表在這邊操作 DOM 都是可能失敗的，因為你無法預知載入 file 時，DOM 有無產生。</p>\n<p><img src=\"../images/asyncdefer.png\" alt=\"async defer\" title=\"script async defer\"></p>\n<p>神圖介紹來源: <a href=\"https://html.spec.whatwg.org/multipage/scripting.html\" title=\"whatwg製\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">whatwg</a></p>\n<p>同時假設在 HTML parser 階段就開始執行 javascript，都會中斷 HTML parser 的，所以這邊要盡量避免在初始化執行大量 javascript，可以用事件監聽 DOM loaded 觸發執行。</p>\n<p>另外就是 CSS import font，實務上常常是這點卡住，這建議用 javascript 非同步方式載入，ps. 我們用過這方法大概推進 lighthouse 20 分左右。</p>\n<p>至於 http 2，目前還有滿多 cdn 尚未支援的，這邊就不多討論，大概概念就是這可以大幅加快 http 請求速度，實現同時多個 http 請求，並且不阻塞。</p>\n<p>最後假設 SPA 是純 client side render 又要追求載入速度的話，直接起跑點就輸了，比較建議考慮直接改 server side render，你用上面邏輯跑一遍，就大概知道這是 飛機 vs 機車的差距了。</p>\n<h2>心得</h2>\n<p>我自己是覺得原理滿重要的，當初在學習前端時候，常常只是無腦跟著教學走，只是覺得瀏覽器真神奇，各種炫砲畫面，假設知道原理後，就更容易知道問題在哪裏，其實我原本是想寫 CSS animation 的，沒想到研究研究就覺得這應該也滿重要的，就先寫這篇了。</p>\n<p>下方內容滿推薦的，真心推薦前端都需要看過一遍，會對於效能這件事，有更深的了解。</p>\n<p>google 教學: <a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path\" title=\"網頁渲染運作邏輯\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">網頁渲染運作邏輯</a></p>\n<p>一樣感謝閱讀，有問題歡迎留</p>","frontmatter":{"title":"Critical Rendering Path 關鍵渲染路徑優化","date":"February 11, 2021","description":"假設你有針對 google page speed、lighthouse 優化過，應該會特別有感觸，該如何才能讓網頁載入更快。接下來討論如何讓畫面渲染載入更快，以及一些最佳化使用方式。","categories":"javascript","tags":["css"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAARlAAAEZQAGA43XUAAACbUlEQVQozwFiAp39AL9cX8dWXdFSX9xRX+plb/VvdPxPaNxRY4dhbcNZcv0+Z/Z1i/uZoPl/jd9dfNc5YsknUtN6gu7Gt+e7rwDPfErnhEv0jVv5ilT8hVL+h1L/jVDlc1qdXnOpkG//hlD6kG78lov6gX/0VHftNGfaY3/utan3zrzvwrQAs29M4IRN/qhg+ZVl92xj6Gxf3ndT63VRsGhsl5Nq/4pD/JFL/pZb+59z92Z6+g9R5X+Q99fF+su+9se6AKx0UbR8UdKNUd9xVcZUWJVoVKRzUd91TqhxZIKJcv+CTft/WPuKWf2hbPl4gvsTV+smXoRnlW+fn3KNiADNh17fiVfih1bbc1m4ak6xcEu/dUvZd06taWJ+g3H/fVD6dlD/jFvqkm1ZeJa4PXD+FVZzeqxJoaBQhWgAeWxed19hlmhmk01hf1JksGJfrWlmg2FVgl1chIdi+6dY/51ZyItdPGSIC4Wm1TVs6CBaaIWzRKCiWIVsAEFUWz1BaGI9Z644YG0/e1lCfFRLiENMeURNX2Z6aPu+R/q0TmF2cBhajiOUoc5BdcEqbF57r0qdmEaBbABAUmFWPWOEQ2TBTGSQWX6MYnOeZWqXaXRcWWkyY2yrjljKolVCY3UoaolseojGWXO4O3JUe65Mno44fm4ARUpbaDxdikNrzXFZ/JFQ/pJL/5RA+pQ/f3JaTGxqpHtTW3FnPWN4KW2He3NzcWRpJ3WcPJSnRpl8Q4NxAFBPYWE5XqhdVd58RPSKOvqNO/KMQeqJRJB5Wk1saYuEWUpzYypseydqil9yZj5ocS1vj0CDjEqNdUyCbGWEMtnyFUHoAAAAAElFTkSuQmCC","aspectRatio":1.92090395480226,"src":"/static/9544917ac4a00b8c626e23163748bef2/aa110/paintings.png","srcSet":"/static/9544917ac4a00b8c626e23163748bef2/c972b/paintings.png 340w,\n/static/9544917ac4a00b8c626e23163748bef2/27625/paintings.png 680w,\n/static/9544917ac4a00b8c626e23163748bef2/aa110/paintings.png 881w","sizes":"(max-width: 881px) 100vw, 881px"}}}},"timeToRead":2,"parent":{"__typename":"File","modifiedTime":"2021-04-03T11:16:59.789Z"}}},"pageContext":{"slug":"/2021-02-cssperformance/","previous":{"fields":{"slug":"/2020-12-thirtyyearsold/"},"frontmatter":{"title":"30 歲的我","tags":[null]}},"next":{"fields":{"slug":"/2021-05-cssanimation/"},"frontmatter":{"title":"CSS animation Performance","tags":["css"]}}}},"staticQueryHashes":["1481458783","63159454"]}