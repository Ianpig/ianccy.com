{"componentChunkName":"component---src-templates-blog-post-js","path":"/tagteach/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"907f972c-8739-5452-98b9-f19278b54b47","fields":{"slug":"/2018-10-tagteach/"},"headings":[{"value":"Tag manager 設定邏輯","id":null,"depth":2},{"value":"查看 html 標籤","id":null,"depth":3},{"value":"按鈕 HTML","id":null,"depth":4},{"value":"I.觸發條件","id":null,"depth":2},{"value":"tag manager 觸發簡易介紹","id":null,"depth":3},{"value":"網頁瀏覽","id":null,"depth":3},{"value":"點擊","id":null,"depth":3},{"value":"使用者主動參與","id":null,"depth":3},{"value":"其他","id":null,"depth":3},{"value":"II.變數","id":null,"depth":2},{"value":"III.代碼","id":null,"depth":2},{"value":"\b 追蹤 adblock 實作範例","id":null,"depth":2},{"value":"工作實作心得","id":null,"depth":2}],"excerpt":"之前有介紹過如何在 tag manager 安裝 ga 追蹤碼，埋設 tag manager 的追蹤碼到網頁後，再來開始進入 tag manager 設定，首先點選 觸發 建立好觸發邏輯，再進入 代碼 增加 ga…","html":"<p>之前有介紹過如何在 tag manager 安裝 ga 追蹤碼，埋設 tag manager 的追蹤碼到網頁後，再來開始進入 tag manager 設定，首先點選 <em>觸發</em> 建立好觸發邏輯，再進入 <em>代碼</em> 增加 ga 追蹤碼，綁定設定好的觸發點，再點選提交上去，就完成設定了。</p>\n<p>雖然上次有順手寫掉事件設定，但沒有特別介紹每個設定的邏輯，這次會帶更多細節。以 <a href=\"https://work.ianccy.com/commentboard/\" title=\"留言板\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">留言板</a> 為範例。</p>\n<p>假設我們要追蹤送出留言，建立一個事件，拿進 ga 當作轉換目標。</p>\n<p>文章連結：<a href=\"https://ianccy.com/tagmanager/\" title=\"tag manager 安裝追蹤碼\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tag manager 安裝追蹤碼</a></p>\n<!--- ![google tagmanager](../images/tagtool.png \"google tagmanager\") --->\n<h2>Tag manager 設定邏輯</h2>\n<pre><code class=\"language-javascript\">設定 trigger(觸發) => 設定 tag(代碼) => publish(提交)\n\nps. 每個步驟中都可以使用變數\n</code></pre>\n<h3>查看 html 標籤</h3>\n<p>所有的設定都會走上面的流程，每個代碼都一定要包含觸發。這邊我們先做一個觸發，時機點是在送出留言的時候。</p>\n<p>我們先打開連結 => <a href=\"https://work.ianccy.com/commentboard/\" title=\"留言板\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">留言板</a>，打開 chrome devtool( 滑鼠右鍵 -> 檢查 )，點選上面的 Elements，點擊左上角的游標標誌。</p>\n<p><img src=\"../images/tagchromedev.png\" alt=\"chrome devtool\" title=\"chrome devtool\"></p>\n<p>再把游標移到網頁上，會發現出現選取整個區塊，這時候移動到送出按鈕，用游標點擊一下，會發現右邊的 html 會變成選取樣式。</p>\n<p><img src=\"../images/tagchromedev2.png\" alt=\"chrome devtool2\" title=\"chrome devtool2\"></p>\n<h4>按鈕 HTML</h4>\n<pre><code class=\"language-javascript\">&#x3C;button type=\"button\" id=\"submitComment\" class=\"btn btn-secondary\">\n    送出\n&#x3C;/button>\n</code></pre>\n<p>這時候會發現按鈕的 id <code>submitComment</code>，通常來說一個頁面的 id 只會存在一個，所以我們會用這個 id 被點擊來作為觸發點，如果你要用 className 也是沒問題，只要處理好判斷即可。</p>\n<p>學會查看網頁的 html 很重要，學會這個工具的話，對你在設定追蹤數據有很大幫助。</p>\n<h2>I.觸發條件</h2>\n<p>先來開始 tag manager 第一個步驟，設定觸發條件。</p>\n<p>打開 tag manager 網頁 <a href=\"https://tagmanager.google.com\" title=\"tagmanager\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tagmanager</a>，點擊觸發條件 => 新增。</p>\n<p><img src=\"../images/tagtri.png\" alt=\"tag manager trigger\" title=\"tag manager trigger\"></p>\n<p>這時候點擊觸發條件設定，右邊會展開一大堆選項，\b 大概分類為 網頁瀏覽、點擊、使用者主動參與、其他，這四種。</p>\n<p>我們選擇點擊元素，依狀況不同設定進階條件。選擇要執行的網頁路徑、click id 填上 submitComment。</p>\n<p><img src=\"../images/tagsmaple4.png\" alt=\"tag manager tagsmaple4\" title=\"tag manager tagsmaple4\"></p>\n<h3>tag manager 觸發簡易介紹</h3>\n<p><a href=\"https://support.google.com/tagmanager/topic/7679384?hl=zh-Hant&#x26;ref_topic=3441647\" title=\"tag manager 官方觸發條件介紹\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tag manager 官方觸發條件介紹</a></p>\n<h3>網頁瀏覽</h3>\n<ul>\n<li>網頁瀏覽\n使用者一進入網頁，就會觸發 網頁瀏覽。</li>\n<li>DOM 就緒\n當使用者進入網頁後，會開始讀取 DOM (html)內容，從上往下跑一次，跑到底就會觸發 DOM 就緒。</li>\n<li>視窗已載入\n當讀取完成 DOM 之後，會繼續執行載入檔案內容，例如圖片、影片、js css 檔案、iframe 等等，當這些都載入完成，就會觸發 視窗已載入。</li>\n</ul>\n<h3>點擊</h3>\n<ul>\n<li>僅連結\n使用者點選連結 (<code>&#x3C;a href=\"domain/pathname\">Link Text&#x3C;/a></code>)，才會觸發。</li>\n<li>所有元素\n使用者隨意在頁面上做點擊動作，就會觸發。例如我點了網頁的空白區塊，就會觸發了。</li>\n</ul>\n<h3>使用者主動參與</h3>\n<ul>\n<li>YouTube 影片\n當網站上嵌入 youtube 影片，觀看影片的各種狀況，開始、暫停、完成播放，觀看影片的百分比設定。</li>\n<li>元素可見度\n網頁上物件出現在畫面上，都可以算是觸發元素可見度。包括載入出現、滾動出現、變化樣式 css 等等。</li>\n<li>捲動頁數\n針對滾動整個網頁觸發，用來計算滾動的百分比，可以讓自己定義要追蹤的比率。</li>\n<li>表單提交\n使用者提交表單就會觸發，<code>&#x3C;form>&#x3C;button>送出&#x3C;/button>&#x3C;/form></code>form html 架構才會觸發，如果是使用 javascript ajax 傳輸，就不會觸發到表單提交。</li>\n</ul>\n<h3>其他</h3>\n<ul>\n<li>JavaScript 錯誤\n使用 window.onError 來監聽錯誤，會提供錯誤訊息、錯誤網址、錯誤行號碼等資訊。</li>\n<li>自訂事件\ndataLayer.push({event:{eventName}})，會依照 dataLayer 中 event 觸發。</li>\n<li>計時器\n可以設定某個動作觸發開始計時，之後再依照設定的時間倒數後在觸發另一個事件。</li>\n<li>記錄變更\n當使用 history.pushState()時會被觸發，可以處理 spa 的網址變化，運用在 react-router。</li>\n</ul>\n<p><img src=\"../images/triggerlist.png\" alt=\"tag manager triggerlist\" title=\"tag manager triggerlist\"></p>\n<h2>II.變數</h2>\n<p>變數可能會比較抽象，簡單介紹一下什麼叫做變數，變數可以當作<code>賦予某個值一個名稱</code>，至於為什麼要命名變數，因為方便我們之後可以直接拿這個變數名稱來使用。</p>\n<p>打開變數區塊=>點擊新增，會看到 tag manager 會預設好幾個比較常用到的變數，click text、url、pathName 等等，下方還可以讓你新增使用者自己的變數，有很多種可以新增，比較常用的會是 dataLayer 帶變數、還有 javascript function return。</p>\n<ul>\n<li>javascript function return - 回傳留言欄位的內容</li>\n</ul>\n<pre><code class=\"language-javascript\">function(){\n  return document.getElementById('commentValue').value\n}\n</code></pre>\n<p><img src=\"../images/tagtitle.png\" alt=\"tag manager tagtitle\" title=\"tag manager tagtitle\">\n上面的名稱我取作 comment<em>value，也就是說之後只要其他地方輸入 {{comment</em>value}} 就可以取得留言的內容。</p>\n<p>這邊如果不會寫 javascript 的話，也可以使用內建好的變數，記得要勾選後才能被取用。</p>\n<h2>III.代碼</h2>\n<p>這部分就是 tag manager 的核心，經由設定觸發條件，然後執行代碼。tag manager 整合非常多的不同工具，除了 facebook pixel\b...。</p>\n<p><a href=\"https://support.google.com/tagmanager/answer/6106924\" title=\"tag manager 支援代碼\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tag manager 支援代碼</a></p>\n<p>我們以 ga 設定事件為例子，原本你在 ga 設定事件，會需要在網站上寫<code>ga('send', 'event', 類別, 動作, 標籤 )</code>，在這邊都視覺化了，每個類別、動作、標籤都分欄位讓你輸入，所以不用會寫 javascript，你也可以輕易設定事件，更重要是不需要透過工程師幫你處理。</p>\n<p>簡單講就是，你在 tag manager 的追蹤設定，不會影響到原本網站上的程式架構。網站上一定會埋一堆哩哩摳摳的程式碼，對工程師來說每建立一個新頁面都要用整包，畫面不乾淨也不好維運。它可以幫助你追蹤碼分離掉。</p>\n<p>點擊代碼新增 => 選擇 google analytics，使用 ga 的事件。</p>\n<p>再來建立類別、動作、標籤，標籤這邊用我們建立的變數<code>comment_value</code>，最後觸發條件再選擇送出留言。</p>\n<p><img src=\"../images/tagsmaple5.png\" alt=\"tag manager tagsmaple5\" title=\"tag manager tagsmaple5\"></p>\n<h2>\b 追蹤 adblock 實作範例</h2>\n<p>上面講了一遍後，再來試著操作一遍，需求是，要追蹤來我的 blog 的人，有多少人使用 adblock，使用 ga 事件來記錄。</p>\n<p>以需求來看，觸發點就會是載入頁面後，判斷廣告區塊沒有正常顯示，所以我們要建立一個觸發，執行 ga 事件的代碼。</p>\n<p>這邊來用 tag manager 代碼區塊的自訂 html。建立一個 javascript，這段是要判斷 google-auto-placed 有沒有在 html 上，這是 google 自動廣告會帶的 className，如果沒有這個 class，就代表使用者有裝設 adblock。然後使用<code>dataLayer.push({event: 'getAdblock'})</code>產生自訂事件。</p>\n<ul>\n<li>代碼區塊使用自訂 html</li>\n</ul>\n<pre><code class=\"language-javascript\">&#x3C;script>\n  if (document.getElementsByClassName('google-auto-placed').length === 0) {\n    dataLayer.push({\n      event: 'getAdblock'\n    });\n  }\n&#x3C;/script>\n</code></pre>\n<p><img src=\"../images/tagsample.png\" alt=\"tag manager tagsample\" title=\"tag manager tagsample\"></p>\n<p>接下來，到觸發區塊點選點選 自訂事件，在輸入剛剛 push event 的名稱 getAdblock。</p>\n<p><img src=\"../images/tagsample3.png\" alt=\"tag manager tagsample3\" title=\"tag manager tagsample3\"></p>\n<p>進入代碼區塊，建立一個 ga 事件，再輸入事件類別、動作、標籤，觸發就選擇剛剛建好的觸發條件。</p>\n<p><img src=\"../images/tagsample2.png\" alt=\"tag manager tagsample2\" title=\"tag manager tagsample2\"></p>\n<p>這樣就大功告成了!!</p>\n<p>ps.記得點開 tag manager 預覽模式，來看一下代碼有沒有成功跑起來。</p>\n<h2>工作實作心得</h2>\n<p>記得我兩年前第一次接觸 tag manager，評語是 <em>這鬼東西太複雜難用了吧</em> 。但不知道是不是兩年間有改版，最近回頭接觸的感想，發現其實滿好用的！特別是預覽模式，很清楚的在發布前測試有沒有設定正確。</p>\n<p>會一直介紹 tag manager 的原因，絕對不是因為我最近每天工作都要接觸 tag manager(眼神死...)，是 tag manager 功能真的太強大了，對前端開發來說也減少非常多的工時，省去在專案上處理各種 ga(xxx)的麻煩、突兀，轉而關注處理 dataLayer。</p>\n<p>最後最後，如果你是行銷人，然後會用 tag manager 的話，我非常敬佩你。</p>\n<p>感謝閱讀！</p>","frontmatter":{"title":"Google Tag Manager(gtm)教學 觸發、代碼、變數設定介紹","date":"October 16, 2018","description":"完整介紹tag manager功能設定細節、功能，建立流程步驟教學，以留言板追蹤為範例。假設我們要追蹤送出留言，建立一個事件，拿進ga當作轉換目標。","categories":"marketing","tags":["tag_manager","google_analytics"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACg0lEQVQoz22P/U8SARzG7z+r1dbaXI2pmHXj5PW4O+447oA7DvB4OV7kRV4URcKXLV0sXTVbtQqr2ZQJoTJwy5cpVm4OVBqazk2lbvZrn5++e77Ps2cP0A7Ku1W4BsENtJm1WO0OwRNOBCIDqfRoKj2eHEkHw5HE0LDLG+zti3CeIEYb9QyHGtlOSAEYTTQv9HIMr74vYThnKJEire5A/+DLF7OZzPTM9PNYbHAoMRQbHnV7PILXQ7A2TzDsDUcY3gE4nBzvdd1qh7rapQMTmYV8MTv3eamwks8XsnPzpbVv2U9fFhdz1a2N12/fuQRBjZN6ytAJQvceygBGo4Bh4nabBMP1U5lnV63Wn//Rutbff/hoolBnL40xNiWMAPo7N+ygVI4RKIKMjDw+Pz8vl8vLy8uFQqFcqYjH6upqLpdbX18Xw4sLuUDQ6YhGY2OT/lAIICVtXZJOt9fvELzJ8SdiQ7PZLJVKovvnNdVqtVgs1mo1MVzML0X7o1qVPD0xFugPArBS09YNYSgSCfXNzr4SHVeXl6K7UqlsbmyUr9ne3r64uBBfX4srZsbic3M+N4tBNwFChxtIgxJGXTbu6VTm38JGo3FyctI8Pq7XDw4PD09Pf7daV6L+JjuPk1SMlweYDsEgATqkD1AMZzk7pFAL0eTu9x87W5t7e3tHjV8H9frZ2el+/Wi/diCW71Z3JjMzFt5H0CxCGA0WHlCqYRB8RFvsEGm7K9OTOl3cyXAEbGOtkUCf3UyxDBeIpyizjTGbYvF4NDludXlCg0lXKA6QRlZHsVoTD6Jm2OSUqVBUo3FbGA0kM6h7UDmo7QG1KpW0QwojOr/Pj4kraRNKMQrC/Be9x5Q8JJZ40AAAAABJRU5ErkJggg==","aspectRatio":1.780104712041885,"src":"/static/fdb7af8a02e2c6e8e80c7e0708d544cf/ee604/tagtool.png","srcSet":"/static/fdb7af8a02e2c6e8e80c7e0708d544cf/c972b/tagtool.png 340w,\n/static/fdb7af8a02e2c6e8e80c7e0708d544cf/27625/tagtool.png 680w,\n/static/fdb7af8a02e2c6e8e80c7e0708d544cf/ee604/tagtool.png 800w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"timeToRead":6,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.141Z"}}},"pageContext":{"slug":"/2018-10-tagteach/","previous":{"fields":{"slug":"/2018-10-nodejsapi/"},"frontmatter":{"title":"Node.js Express MongoDB RESTful Api 留言板實作教學","tags":["node.js"]}},"next":{"fields":{"slug":"/2018-10-imgprogress/"},"frontmatter":{"title":"Upload progress bar drag&drop 圖片拖拉上傳進度條","tags":["javascript"]}}}},"staticQueryHashes":["1481458783","63159454"]}