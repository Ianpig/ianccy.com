{"componentChunkName":"component---src-templates-blog-post-js","path":"/postmessage/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"fdb9616a-ef76-5e11-a9bc-bb74486e6329","fields":{"slug":"/2018-09-postmessage/"},"headings":[{"value":"window postMessage 介紹","id":"window-postmessage-介紹","depth":2},{"value":"window open demo page","id":"window-open-demo-page","depth":2},{"value":"iframe demo page","id":"iframe-demo-page","depth":2}],"excerpt":"最近在公司專案學到了滿好用的功能 postMessage，當今天使用到跨視窗 iframe 或是 openWindow，原本 parent 頁面需要傳遞訊息給內頁 iframe 或是 tab 頁，就可以利用 postMessage 來傳遞資料。接下來會建立 demo 頁面，介紹一下 iframe 跟 window…","html":"<p>最近在公司專案學到了滿好用的功能 postMessage，當今天使用到跨視窗 iframe 或是 openWindow，原本 parent 頁面需要傳遞訊息給內頁 iframe 或是 tab 頁，就可以利用 postMessage 來傳遞資料。接下來會建立 demo 頁面，介紹一下 iframe 跟 window open 的使用方法。</p>\n<!--- ![JavaScript](../images/post_message.png \"JavaScript\") --->\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">window.postMessage() 方法被調用時，會在所有頁面腳本執行完畢之後\n（e.g., 在該方法之後設置的事件、之前設置的timeout 事件,etc.）\n向目標窗口派發一個  MessageEvent 消息。\n\n該MessageEvent消息有四個屬性需要注意：\nmessage 屬性表示該message 的類型；\ndata 屬性為 window.postMessage 的第一個參數；\norigin 屬性表示調用 window.postMessage() 方法時調用頁面的當前狀態；\nsource 屬性記錄調用 window.postMessage() 方法的窗口信息。</code>\n        </deckgo-highlight-code>\n<h2 id=\"window-postmessage-介紹\" style=\"position:relative;\"><a href=\"#window-postmessage-%E4%BB%8B%E7%B4%B9\" aria-label=\"window postmessage 介紹 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>window postMessage 介紹</h2>\n<p>postMessage 的調用方式 => targetWindow.postMessage(message, targetOrigin, [transfer])，targetWindow 會是某個窗口，targetOrigin 則是指定可傳遞的端口網域，transfer 是一串和 message 同時傳遞的 Transferable 對象。</p>\n<p>targetWindow 可設定目標 :</p>\n<ul>\n<li>Window.open</li>\n<li>Window.opener</li>\n<li>HTMLIFrameElement.contentWindow (embedded iframe ),</li>\n<li>Window.parent ( parent window embedded iframe)</li>\n<li>Window.frames + an index value (named or numeric).</li>\n</ul>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage#Syntax\" title=\"window postMessage MDN\">window postMessage MDN </a></p>\n<h2 id=\"window-open-demo-page\" style=\"position:relative;\"><a href=\"#window-open-demo-page\" aria-label=\"window open demo page permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>window open demo page</h2>\n<p>首先要建立送出訊息跟接受訊息的頁面，送出訊息頁面主要做兩件事情，開啟視窗並指定為變數、向剛剛開啟視窗頁面送出訊息。javascript 沒有特別難度，所以就直接看我建立好的頁面，底下是處理的 html 還有 javascript。</p>\n<p>範例 :</p>\n<ul>\n<li>使用步驟 先點選開啟視窗</li>\n<li>輸入隨意字串</li>\n<li>點選送出按鈕</li>\n</ul>\n<p>ps.分頁切換需要用瀏覽器 app safari、chrome</p>\n<iframe src=\"https://work.ianccy.com/postmessage/send.html\" width=\"100%\" height=\"300px\" frameborder=\"0\" scrolling=\"no\"></iframe>\n<p>Source : <a href=\"https://work.ianccy.com/postmessage/send.html\" target=\"_blank\">Open Window Demo Page</a></p>\n<p>send.html</p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">&lt;!DOCTYPE html&gt;\n...\n  &lt;h1 class=&quot;cover-heading&quot;&gt;HTML send Post Message demo sample.&lt;/h1&gt;\n  &lt;p class=&quot;lead&quot;&gt;\n      &lt;button id=&quot;openWindow&quot; type=&quot;button&quot; class=&quot;btn btn-info&quot;&gt;開啟視窗&lt;/button&gt;\n  &lt;/p&gt;\n  &lt;div class=&quot;input-group&quot;&gt;\n    &lt;input type=&quot;text&quot; id=&quot;messageText&quot; class=&quot;form-control&quot; placeholder=&quot;輸入訊息&quot;&gt;\n    &lt;div class=&quot;input-group-append&quot;&gt;\n      &lt;button id=&quot;postWindow&quot; class=&quot;btn btn-info btn-outline-secondary&quot; type=&quot;button&quot;&gt;送出訊息&lt;/button&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n...\n  &lt;script&gt;\n    // 建立變數\n    var createWindow;\n    document.getElementById(&#39;openWindow&#39;).addEventListener(&#39;click&#39;,function(e){\n    // 將變數 assign window open 物件\n      createWindow = window.open(&quot;./receive.html&quot;);\n    });\n    document.getElementById(&#39;postWindow&#39;).addEventListener(&#39;click&#39;,function(e){\n      sendMsg();\n    });\n    function sendMsg() {\n      var message = document.getElementById(&quot;messageText&quot;).value;\n      var domain = window.location.origin;\n      // post message\n      createWindow.postMessage(message, domain);\n      // focus windowOpen\n      createWindow.focus();\n      document.getElementById(&quot;messageText&quot;).value = &#39;&#39;;\n    }\n  &lt;/script&gt;\n...\n&lt;/html&gt;</code>\n        </deckgo-highlight-code>\n<p>recevie.html</p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">&lt;!DOCTYPE html&gt;\n...\n    &lt;p class=&quot;lead&quot;&gt;\n      &lt;h2 id=&quot;response&quot;&gt;&lt;/h2&gt;\n    &lt;/p&gt;\n...\n    &lt;script&gt;\n      window.addEventListener(&quot;message&quot;, getMessage, false);\n      function getMessage(e) {\n        var content = &#39;&#39;;\n        // e.data 接受傳遞訊息\n        content += &quot;Get Message =&gt;&quot; + e.data + &#39;&lt;br&gt;&#39;;\n        // e.origin 接受訊息domain\n        content += &quot;Url from &quot; + e.origin;\n        document.getElementById(&quot;response&quot;).innerHTML = &quot;&lt;p&gt;&quot; + content + &quot;&lt;/p&gt;&quot;;\n      };\n    &lt;/script&gt;\n...\n&lt;/html&gt;</code>\n        </deckgo-highlight-code>\n<h2 id=\"iframe-demo-page\" style=\"position:relative;\"><a href=\"#iframe-demo-page\" aria-label=\"iframe demo page permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>iframe demo page</h2>\n<p>這個會比較特別，window open 是原本頁面傳給開啟頁面，iframe 則會使用 iframe embed 內部的網站傳遞資料給外部 parent，範例情境大概是修正 iframe 的高度，</p>\n<p>範例 : (白色區塊是使用 iframe)</p>\n<ul>\n<li>點選 iframe 內 伸縮高度按鈕</li>\n<li>點擊按鈕後，會變化 body 高度，並傳值到 parent window</li>\n<li>parent window 接受到值後，變化 iframe style height</li>\n</ul>\n<iframe id=\"addIframe\" src=\"https://work.ianccy.com/postmessage/embed.html\" width=\"100%\" height=\"200px\"></iframe>\n<p>Source : <a href=\"https://work.ianccy.com/postmessage/iframe.html\" target=\"_blank\">Iframe Demo Page</a></p>\n<p>iframe.html</p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">...\n  &lt;script&gt;\n      // 接受傳遞訊息 變化iframe height\n      window.addEventListener(&quot;message&quot;, getMessage, false);\n      function getMessage(e) {\n        if(e.data.event_id) {\n          document.getElementById(&#39;addIframe&#39;).style.height = e.data.data + &#39;px&#39;;\n        }\n      };\n  &lt;/script&gt;\n...</code>\n        </deckgo-highlight-code>\n<p>embed.html</p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">...\n    &lt;script&gt;\n        document.getElementById(&#39;postWindow&#39;).addEventListener(&#39;click&#39;, function (e) {\n          sendMsg();\n        });\n        function sendMsg() {\n          var height = document.body.scrollHeight;\n          // 向parent window 送出訊息\n          window.parent.postMessage(\n              {\n                  event_id: &#39;my_cors_message&#39;,\n                  data: height\n              },\n              &quot;*&quot; // or &quot;www.parentpage.com&quot;\n          );\n        }\n    &lt;/script&gt;\n...</code>\n        </deckgo-highlight-code>\n<p>以上就是簡單的 demo，還有更多延伸的運用，例如做出開視窗會員註冊，送出後傳遞資料回原本頁面渲染畫面。另外當你今天不得不用 iframe 的話，postMessage 會非常好用，賦予 iframe 更有彈性。另外提醒一下，實際運用要記得判斷 post Message 的網址，避免外部可能的攻擊。</p>","frontmatter":{"title":"HTML postMessage iframe and open window 跨視窗傳訊用法","date":"September 23, 2018","description":"當今天使用到跨視窗iframe或是openWindow，原本parent頁面需要傳遞訊息給內頁iframe或是tab頁，就可以利用postMessage來傳遞資料。接下來會建立demo頁面，介紹一下iframe跟window open的使用方法。","categories":"javascript","tags":["javascript"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5ElEQVQoz6WRyw6CMBBF+RlseQiBBYJFyiOSyE9gAixUwA2NqcZ+uxOMxoCoiWfRdJrcO3em0vwPpEFtGIZpmsaD1zvwSazrOupRVVXpwT33Es5JMSgty0qSeJ2mnucGQUAIieOYUuq6Lrw4jgNB3oghEpj7q1XTtIydtnleFOWxbVnHOL/UdcP5WYjrYuFomvbMP5hZh5AhpVEUkSWhNAjD0Pd96A9tbduGdJMzgyUY73Z71nVlWVZVdeb8cKiFEFm2Ad/BzqTxB8x6EMIIY1mWMVYQmsG2vmz72X/wPWPZpPh3buBtefoBeE+IAAAAAElFTkSuQmCC","aspectRatio":1.9767441860465116,"src":"/static/f481421794be4d14e0e3c6cfc1eee0a7/07362/post_message.png","srcSet":"/static/f481421794be4d14e0e3c6cfc1eee0a7/c972b/post_message.png 340w,\n/static/f481421794be4d14e0e3c6cfc1eee0a7/07362/post_message.png 674w","sizes":"(max-width: 674px) 100vw, 674px"}}}},"timeToRead":4,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.139Z"}}},"pageContext":{"slug":"/2018-09-postmessage/","previous":{"fields":{"slug":"/2018-08-tagmanager/"},"frontmatter":{"title":"Google Tag Manager tracking code 安裝追蹤碼","tags":["tag_manager","google_analytics"]}},"next":{"fields":{"slug":"/2018-09-searchconsle/"},"frontmatter":{"title":"Google Search Console教學 提交Sitemap網址、SEO工具","tags":["seo"]}}}},"staticQueryHashes":["1481458783","63159454"]}