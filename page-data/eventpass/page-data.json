{"componentChunkName":"component---src-templates-blog-post-js","path":"/eventpass/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"2064f693-4528-566d-863d-1226e5da3ff0","fields":{"slug":"/2019-03-eventpass/"},"headings":[{"value":"DOM 一般事件綁定","id":null,"depth":2},{"value":"事件傳遞 Capture Bubble","id":null,"depth":2},{"value":"Capture Bubble 實用範例","id":null,"depth":2},{"value":"心得","id":null,"depth":2}],"excerpt":"JavaScript 處理 DOM 事件上的獲取和冒泡，實務上滿常用到的觀念，可以透過這方式解決一些麻煩問題，例如: popup 視窗的關閉、內外層 DOM 互動關係，另外事件獲取、冒泡也幾乎是面試必考題。 DOM 一般事件綁定 下面的例子，我 container 先綁定 click 事件，再綁定 first…","html":"<p>JavaScript 處理 DOM 事件上的獲取和冒泡，實務上滿常用到的觀念，可以透過這方式解決一些麻煩問題，例如: popup 視窗的關閉、內外層 DOM 互動關係，另外事件獲取、冒泡也幾乎是面試必考題。</p>\n<!--- ![JavaScript logo](../images/JavaScript-logo.png \"JavaScript logo\")\n--->\n<h2>DOM 一般事件綁定</h2>\n<p>下面的例子，我 container 先綁定 click 事件，再綁定 first，各自彈出自己的 id 名稱，那哪個會先 alert 出來。</p>\n<pre><code class=\"language-javascript\">&#x3C;div id=\"container\">container\n  &#x3C;ul id=\"list\">ist\n    &#x3C;li id=\"first\">number 1&#x3C;/li>\n  &#x3C;/ul>\n&#x3C;/div>\n...\n&#x3C;script>\ndocument.getElementById('container').addEventListener('click',function(e){\n  alert(this.id);\n});\ndocument.getElementById('first').addEventListener('click',function(e){\n  alert(this.id);\n});\n&#x3C;/script>\n</code></pre>\n<p>會是 first 先彈跳出來，因為綁定事件順序並不是代表執行順序，單純只是哪個 DOM 先綁定事件監聽，實際執行序還是要依照 DOM 父子關係判定，除非是綁定到同個 DOM 上，才會依照先後綁定順序執行。</p>\n<iframe src=\"//codepen.io/chu1228/embed/rRqGga/?height=400&theme-id=0&default-tab=result\" width=\"100%\" height=\"290\"></iframe>\n<h2>事件傳遞 Capture Bubble</h2>\n<p>我們可以在 addEventListener('click',function(){}, <code>true</code>)，來決定 useCapture 參數的 boolean，預設沒帶會是設為 false，當 usecaptue 為 true 時，事件觸發會先經由 DOM tree 一路往子層到目標為止，之後再冒泡上去父層，這樣一個完整的流程就是事件獲取與冒泡。</p>\n<p>最重要就是我們有辦法阻止事件獲取冒泡的傳遞，利用 event.stopPropagation function，就可以阻止事件往後傳遞。</p>\n<p>另外 event 還有提供物件 eventPhase，會回傳 0~4 的數值，讓我們可以清楚知道這個事件到什麼階段。</p>\n<pre><code class=\"language-javascript\">eventPhase: 0 沒有事件\neventPhase: 1 獲取階段，會以物件父層一直到最高開始執行，最頂端會是Window，\n              再來Document，Html，一直到目標為止。\neventPhase: 2 目標階段，這代表事件執行到目標\neventPhase: 3 冒泡階段，會由目標物件的第一層父層開始，一路往上到最頂端window為止。\n</code></pre>\n<p><a href=\"https://developer.mozilla.org/zh-TW/docs/Web/API/EventTarget/addEventListener#%E5%8F%83%E6%95%B8\" title=\"EventListener usecapture MDN\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">EventListener usecapture MDN</a></p>\n<p><img src=\"../images/dompass.png\" alt=\"JavaScript dompass\" title=\"JavaScript dompass\"></p>\n<pre><code class=\"language-javascript\">// get All elements\nconst nodeList = [...document.querySelectorAll('*')];\n\n// add All elements eventListener\nnodeList.forEach(elem => {\n    // use true is for capture\n    elem.addEventListener(\n        'click',\n        e => alert(`capture ${elem.tagName} phase:${e.eventPhase}`),\n        true\n    );\n    // default false is for bubble\n    elem.addEventListener('click', e => alert(`bubble: ${elem.tagName} phase:${e.eventPhase}`));\n});\n</code></pre>\n<iframe src=\"//codepen.io/chu1228/embed/EMdwVJ/?height=400&theme-id=0&default-tab=result\" width=\"100%\" height=\"290\"></iframe>\n<p><a href=\"https://codepen.io/chu1228/pen/EMdwVJ\" title=\"獲取&#x26;冒泡\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">簡易獲取&#x26;冒泡</a></p>\n<p><a href=\"https://codepen.io/pen/?&#x26;editable=true\" title=\"MDN eventphase flow\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MDN eventphase flow</a> (MDN 教學)</p>\n<h2>Capture Bubble 實用範例</h2>\n<p>這邊我們用最經典的 popup 例子，需求是要點擊按鈕 click 會讓 popup 顯示的，但在這邊我們希望 popup 內部點擊不會關閉 popup，但是點外部隨便空間會關閉 popup。</p>\n<p>首先監聽 body 點擊會關閉 popup，再來監聽 openPop 按鈕點擊讓 popup 打開，這邊還多下了 <code>e.stopPropagation()</code>;，防止我點擊 popup 打開觸發 body 點擊被關閉，因為這樣可以中斷點擊 popup 往上冒泡觸發 body 事件。</p>\n<p>再來是 popup 本身需要能點選內部內容，同樣我們也對 popup 使用 e.stopPropagation(); ，讓我們可以點擊 popup 裡面的內容、按鈕。</p>\n<pre><code class=\"language-javascript\">&#x3C;button id=\"openPop\">open popup&#x3C;/button>\n&#x3C;div id=\"text\">&#x3C;/div> // fake wording\n&#x3C;div id=\"popup\" class=\"\">\n  &#x3C;span id=\"closePop\">x&#x3C;/span>\n  &#x3C;div>\n    This is popup\n    &#x3C;button onclick=\"alert('hello')\">Alert Button&#x3C;/button>\n   &#x3C;/div>\n&#x3C;/div>\n...\nconst popup = document.getElementById('popup');\ndocument.getElementById('openPop').addEventListener('click',(e)=>{\n    e.stopPropagation();\n    popup.classList.add(\"active\");\n});\n\ndocument.body.addEventListener('click',()=>{\n    close();\n});\n\npopup.addEventListener('click',(e)=>{\n    e.stopPropagation();\n});\n\ndocument.getElementById('closePop').addEventListener('click',()=>{\n    close();\n});\n\nfunction close () {\n    popup.classList.remove('active');\n}\n</code></pre>\n<iframe src=\"//codepen.io/chu1228/embed/MxzoZK/?height=400&theme-id=0&default-tab=result\" width=\"100%\" height=\"390\"></iframe>\n<h2>心得</h2>\n<p>這觀念真心覺得實用，很多疑難雜症可以處理，或是可以少綁一些 eventlistener，利用父層子層獲取冒泡關係，搭配 stopPropagation。</p>","frontmatter":{"title":"JavaScript Capture Bubble DOM事件獲取&冒泡","date":"March 21, 2019","description":"JavaScript處理DOM事件上的獲取和冒泡，實務上滿常用到的觀念，可以透過這方式解決一些麻煩問題，例如popup視窗的關閉、內外層DOM互動關係，另外事件獲取、冒泡也幾乎是面試必考題。","categories":"javascript","tags":["javascript"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz3WSC2/CIBCA/f9/a1OTZXFmupnpdJkWR2uhLa0tr+MGfUyjGb3cAb2Pu+MYOecAgvImWGuBEKDUEdLL4eAoDb9ar9YfOj1CRD8LKlg/QQtWlIJnTMoGnIUeCce3Hu5Pj7xBdyFrU2tr0rwmSV416j19U1aHAL0M5A3sD/ZOi9Prmm/iDD8OQmncFdtlNMf4rI7MMNHD/0XWYMbHiQZNc7qNP4US0/2Y5yeU1kp1C3c1dwtbS5TuK9nN6Uslqw1dpyLhDZ+QKQ45433N3Zb54SpKMTnPyPO+IiiFJDMs9stksWIrz8MffZN2+wVpnexD9MhKAmWsCtLoMsq+UTvbqNDYIfnryBh61w7P5zIjZQxKnE9PppgDZ/qYacJA6SF1Dw9Nd1fN7HhrjSjyImdGN32EFrt/JJfRLftLvWx27wiH+oLDL99ef+eDNDHnAAAAAElFTkSuQmCC","aspectRatio":1.7435897435897436,"src":"/static/2cd7d323a2c45583b490d8632d71165c/ee604/dompass.png","srcSet":"/static/2cd7d323a2c45583b490d8632d71165c/c972b/dompass.png 340w,\n/static/2cd7d323a2c45583b490d8632d71165c/27625/dompass.png 680w,\n/static/2cd7d323a2c45583b490d8632d71165c/ee604/dompass.png 800w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"timeToRead":3,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.149Z"}}},"pageContext":{"slug":"/2019-03-eventpass/","previous":{"fields":{"slug":"/2019-02-keywordselect/"},"frontmatter":{"title":"SEO關鍵字分析選擇，優化工具介紹","tags":["seo"]}},"next":{"fields":{"slug":"/2019-03-society/"},"frontmatter":{"title":"聊聊4年前，剛出社會的我","tags":[null]}}}},"staticQueryHashes":["1481458783","63159454"]}