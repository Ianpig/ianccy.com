{"componentChunkName":"component---src-templates-blog-post-js","path":"/gacrossdomain/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"71bf2b65-d5e6-58ca-8002-67357b2745de","fields":{"slug":"/2019-08-gacrossdomain/"},"headings":[{"value":"google analytics 追蹤碼修改","id":null,"depth":2},{"value":"傳統追蹤碼","id":null,"depth":3},{"value":"tag manager 追蹤碼","id":null,"depth":3},{"value":"google analytics 設定排除參照連結","id":null,"depth":3},{"value":"網址參數 _ga","id":null,"depth":2},{"value":"共用 google analytics 追蹤代碼","id":null,"depth":2},{"value":"報表檢視增加 domain","id":null,"depth":2},{"value":"心得","id":null,"depth":2}],"excerpt":"如果你有多個網站服務，每個服務又是各自在不同網域上，就會遇到一個棘手的問題，無法確切的追蹤使用者數據。或許你現在還沒遇到，但我來舉個例子讓你理解問題怎麼發生。 情境假設，你今天操作 google ads 的 landing page 是 example.com，但是使用者後續造訪頁面是 buyservice.com…","html":"<p>如果你有多個網站服務，每個服務又是各自在不同網域上，就會遇到一個棘手的問題，無法確切的追蹤使用者數據。或許你現在還沒遇到，但我來舉個例子讓你理解問題怎麼發生。</p>\n<p>情境假設，你今天操作 google ads 的 landing page 是 example.com，但是使用者後續造訪頁面是 buyservice.com，你的 buyservice.com 上 google analytics 數據就會有問題，會在報表看到使用者的 <code>參考來源</code> 會是 example.com，而不是 google ads ，這樣就會無法正確估算 example.com 帶給 buyservice.com 的廣告效益。</p>\n<!--- ![google analytics cross domain tracking](../images/gacrossdomain.png \"google analytics cross domain tracking\") --->\n<p>這是因為 google analytics 數據是依賴 cookie 做定位使用者 (Client-ID)，但是 cookie 有個限制， 同一個 cookie 只能在同 domain 下共同享有，所以跨網域就會斷掉追蹤數據，但還好 google analytics 有提供 <code>跨網域追蹤</code> 功能，讓我們解決這個問題。後面就來嘗試跨網域追蹤設定。</p>\n<p>官方教學: <a href=\"https://support.google.com/analytics/answer/1034342?hl=zh-Hant\" title=\"設定跨網域追蹤 (analytics.js)\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">設定跨網域追蹤 (analytics.js)</a></p>\n<h2>google analytics 追蹤碼修改</h2>\n<p>需要找出你的 google analytics 設定追蹤碼，再針對 <code>ga('create', 'UA-XXXXXXX-Y', '你的網址')</code> 修改，需要改為 auto，並在後面加上 {'allowLinker': true} 參數，後面再加上 ｀ ga('require', 'linker');｀ ，並加上 <code>ga('linker:autoLink', ['相對應的 domain'] )</code>，這樣就完成了設定。</p>\n<h3>傳統追蹤碼</h3>\n<ul>\n<li>example.com 修改追蹤碼</li>\n</ul>\n<pre><code class=\"language-javascript\">  ga('create', 'UA-XXXXXXX-Y', 'example.com');\n  對這段程式碼進行下列變更 (紅色粗體文字是需要變更的部分)：\n\n  ga('create', 'UA-XXXXXXX-Y', 'auto', {'allowLinker': true});\n  ga('require', 'linker');\n  ga('linker:autoLink', ['buyservice.com'] );\n</code></pre>\n<ul>\n<li>buyservice.com 修改追蹤碼</li>\n</ul>\n<pre><code class=\"language-javascript\">ga('create', 'UA-XXXXXXX-Y', 'auto', { allowLinker: true });\nga('require', 'linker');\nga('linker:autoLink', ['example.com']);\n</code></pre>\n<h3>tag manager 追蹤碼</h3>\n<p>如果你是用 tag manager 設定 google analytics 的話，在 google analaytics 追增設定內的欄位設定(Field)，再增加 allowLinker 值 true，自動連結網址就填上要連動的網域。這樣就完成 tag manager 的設定了。記得 tag manager 的改動要提交更新。</p>\n<p><img src=\"../images/gacrossdomaintagmanager.png\" alt=\"google analytics cross domain tagmanager\" title=\"google analytics cross domain tagmanager\"></p>\n<h3>google analytics 設定排除參照連結</h3>\n<p>當一個網站到另一個網站時，google analytics 會自動建立新的工作階段，如果要跨多個網域追蹤單一工作階段，要把相對應網域加進參照連結網址排除清單。</p>\n<p><img src=\"../images/gacrossdomainsetting.png\" alt=\"google analytics cross domain setting\" title=\"google analytics cross domain setting\"></p>\n<h2>網址參數 _ga</h2>\n<p>完成設定之後，就可以測試看看效果如何，下方是完成設定的 demo ，如果你點擊連結 go to <a href=\"https://thawing-stream-74537.herokuapp.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://thawing-stream-74537.herokuapp.com/</a> 後，會發現網址多一段參數 ?_ga=2.189459235.924386874.1564911255-1438900564.1564911255 ，這就是 google analytics 傳遞 client_id 的參數，依賴這參數可以讓工作階段在跨網域下不中斷。</p>\n<iframe src=\"https://test.ianccy.com/gacrossdomain.html\" width=\"100%\" height=\"400\"></iframe>\n<h2>共用 google analytics 追蹤代碼</h2>\n<p>如果你是分開兩個 google analytics 帳戶，還是會無法延續追蹤資訊，只能共用 client<em>id ，但這意義不大，因為通常 client</em>id 都會設定成會員 id，所以網站通常都會共用 client_id，所以我們要再多額外開一個檢視資料，產生一組新的追蹤代碼，讓兩個互相跨 domain 網站共用。</p>\n<ul>\n<li>載入 <a href=\"https://test.ianccy.com/gacrossdomain.html?utm_source=google&#x26;utm_medium=cpc&#x26;utm_campaign=weekend_sale01\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://test.ianccy.com/gacrossdomain.html?utm_source=google&#x26;utm_medium=cpc&#x26;utm_campaign=weekend_sale01</a> utm 數據\n<img src=\"../images/gacrossdomainview.png\" alt=\"google analytics cross domain view data\" title=\"google analytics cross domain setting\"></li>\n<li>載入連結後 <a href=\"https://thawing-stream-74537.herokuapp.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://thawing-stream-74537.herokuapp.com</a> 數據\n<img src=\"../images/gacrossdomainview2.png\" alt=\"google analytics cross domain view data\" title=\"google analytics cross domain setting\"></li>\n</ul>\n<p>這樣就發現我們把 utm 的追蹤資訊延續下去了，一般狀況沒設定 cross domain 共享 client_id 的話，會變成兩個 session，因為 cookie 無法共享，但這樣對於追蹤來說，就有非常大的幫助，我們不用在擔心數據掉落的問題。</p>\n<h2>報表檢視增加 domain</h2>\n<p>如果在檢視報表時，沒有顯示 domain 的話，會不方便直觀分辨網址的 domain 問題，因為 google analytics 預設不顯示 domain，我們要在設定增加顯示，以便我們觀看數據。</p>\n<p>點選篩選器 => 自訂 => 進階，分別在前兩個 選擇主機名稱 內容填上 <code>(.*)</code>，這代表我們要取全部的 domain name，請求 URI 則是 填上 <code>(.*)</code>，取用全部請求網址，後面 輸出至 -> 建構函式 再分別選擇 URI，內容填上 <code>$A1$B1</code>，取用前面兩個條件拿到全部值。</p>\n<ul>\n<li>google analytics 篩選器設定\n<img src=\"../images/gacrossdomainsetting3.png\" alt=\"google analytics cross domain setting\" title=\"google analytics cross domain setting\"></li>\n<li>檢視報表\n<img src=\"../images/gacrossdomainview3.png\" alt=\"google analytics cross domain view data\" title=\"google analytics cross domain view data\"></li>\n</ul>\n<p>這樣就完成了整個設定，達到了跨網域追蹤的功能！</p>\n<h2>心得</h2>\n<p>雖然這跨網域追蹤一直以來都存在著，以前擔任行銷時，可惜沒有使用到這個功能，公司網址包含 blog 的話大概有 6 個，如果都有設定的話，就更能了解轉換的流程。以往都只能在站內連結上加上 utm，被動地去追蹤數據，但假設是 google ads 進來的流量，但到第二個 domain 成效歸屬就被認為是站內連結，模糊了數據的焦點。</p>","frontmatter":{"title":"GA跨網域追蹤 google analytics cross-domain tracking","date":"August 04, 2019","description":"如果你有多個網站服務，每個服務又是各自在不同網域上，就會遇到一個棘手的問題，無法確切的追蹤使用者數據。google analytics有提供跨網域追蹤，讓我們解決這個問題，後面就來嘗試跨網域追蹤設定。","categories":"marketing","tags":["google_analytics"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABgklEQVQoz41RSU/CUBDuTzWKIgdRiRijiQoB2gJS9pBCWxZjYoxKgWjib8DEeAANN+LJhVChRR9vcSqLHJ3M4Zt532zv4+iCsf/ZnM/NU2OMHzudZqt132432637pzYA223QmmTg9eH5GWM8KeFg3mTm0LJ2M8kVPrAeEVxRcVUMrYV5wM4I7wzzrogA2CEEPUkJmGNiV3GEshGimLD+wNzPZR0iv8wLx0ohfFo6Oav4VFkoa2KlHCxpR0reIQZ30omXN7M3hE0p9zVm3XdsWKz7OvRms+64BDyfqu7lctGzCl/W/Jp2WMj7tWKgVAyVlANZ/jBMhFnfJJxhUTS21x6Y1oYkLYUCsJg3k3BLUXc8tp2UNhPSRiziTceh71ZS8qRSQ8sEfm9AuM8RhQUgQOhbadylL6taQ8/XqmpdBxw7r8q6rjZqSl3PXuuJi6vizS1CCPiGSTnzi5KZRsaIwRW2GNP/Z4j8KQS0/ojNyQhuXlSX/BqeOYG2dCGcvdKp2uwHv5m7GnzOsGoAAAAASUVORK5CYII=","aspectRatio":2.2818791946308723,"src":"/static/b7c6b861a9b3305cad2e6b52a4b5aea6/26549/gacrossdomain.png","srcSet":"/static/b7c6b861a9b3305cad2e6b52a4b5aea6/c972b/gacrossdomain.png 340w,\n/static/b7c6b861a9b3305cad2e6b52a4b5aea6/27625/gacrossdomain.png 680w,\n/static/b7c6b861a9b3305cad2e6b52a4b5aea6/26549/gacrossdomain.png 1189w","sizes":"(max-width: 1189px) 100vw, 1189px"}}}},"timeToRead":4,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.153Z"}}},"pageContext":{"slug":"/2019-08-gacrossdomain/","previous":{"fields":{"slug":"/2019-07-reactcontextapi/"},"frontmatter":{"title":"React Context API 跨元件傳遞資料","tags":["react.js"]}},"next":{"fields":{"slug":"/2019-09-jestunit/"},"frontmatter":{"title":"React Unit Test with Jest 單元測試","tags":["react.js","testing"]}}}},"staticQueryHashes":["1481458783","63159454"]}