{"componentChunkName":"component---src-templates-blog-post-js","path":"/mapcluster/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"24bb8132-1c45-54c2-abe0-15cf4c9c5b27","fields":{"slug":"/2017-12-mapcluster/"},"headings":[{"value":"google map 搭配內建 marker infowindow","id":null,"depth":2},{"value":"實際運作範例 infowindow","id":null,"depth":2},{"value":"google map 運用 library","id":null,"depth":2},{"value":"實際範例 markerwithlabel","id":null,"depth":2},{"value":"實際範例 markercluster","id":null,"depth":2}],"excerpt":"大家好我是 Ian，目前是負責網頁前端，每天工作都在處理各種問題(pm 奇形需求)，順便分享一些相關的解法。\n最近剛好專注在 google map 工具的使用，需要將大量的資料撒上 google map，資料也帶滿多資訊，讓 user 點擊 marker 在拉開 infowindow…","html":"<p>大家好我是 Ian，目前是負責網頁前端，每天工作都在處理各種問題<del>(pm 奇形需求)</del>，順便分享一些相關的解法。\n最近剛好專注在 google map 工具的使用，需要將大量的資料撒上 google map，資料也帶滿多資訊，讓 user 點擊 marker 在拉開 infowindow，又嫌太慢。於是開始研究 marker group 概念的工具，也發現關於 marker library 中文的文件比較少一點，所以就順手寫了 marker 延伸使用範例，也可以直接點開範例看 code。</p>\n<p>分為內建 google map 工具操作，還有運用 google map 團隊所開發的工具，達到更多的功能。<br>\n<br></p>\n<h2>google map 搭配內建 marker infowindow</h2>\n<p>首先先運用比較常用到的功能，google map 下多個 marker，再搭配 marker 的 event 來互動，以下是打開 infowindow 的運用。</p>\n<p>簡單創建多筆經緯度資料，呈現的是搭計程車到地點的價格。</p>\n<pre><code class=\"language-javascript\">//我只標出比較重要部分，其他就codepen點開來看唄\nvar marker = new google.maps.Marker({\n    position: { lat: item.lat, lng: item.lng },\n    map: map,\n    title: item.name,\n    icon: image,\n    data: 'Go to ' + item.name + '&#x3C;br/> Taxi price: ' + item.price\n});\nmarker.addListener('click', function() {\n    infowindow.setContent(this.data);\n    infowindow.open(map, this);\n});\n</code></pre>\n<p>比較特別的是這個寫法，在每個 marker 加入 data 物件，讓 marker 延伸操作性。<br>\n以下圖片實際呼叫 marker 所印出來的資料，可以看到畫線處，出現我們剛剛加入的 data，這樣你就可以利用 marker 來帶一些資料，例如說點擊 marker 可以 call function 然後帶互動，這方法變得方便又輕巧。\nps.可以利用指定某個 marker markerArr[i].setOptions({data=\"/change/image\"})變換 marker 資料。</p>\n<!--- ![google map marker console](../images/markerconsole.png \"google map marker console\") --->\n<h2>實際運作範例 infowindow</h2>\n<iframe height='360' scrolling='no' title='Multipel google map marker with info (basic)' src='//codepen.io/chu1228/embed/rpNzBb/?height=360&theme-id=light&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/chu1228/pen/rpNzBb/'>Multipel google map marker with info (basic)</a> by ianchu (<a href='https://codepen.io/chu1228'>@chu1228</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<br>\n<h2>google map 運用 library</h2>\n<p>感謝 google 大大，其實 googlemap 官方 github 有整理滿多 library <a href=\"https://github.com/googlemaps/v3-utility-library\" title=\"google map library\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">google map library</a>，建議下載使用，因為滿多工具 demo 頁面都呈現 404...。</p>\n<p>這邊要用的是<a href=\"https://github.com/googlemaps/v3-utility-library/tree/master/markerwithlabel\" title=\"google map library\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">markerwithlabel</a> 還有 <a href=\"https://github.com/googlemaps/v3-utility-library/tree/master/markerclusterer\" title=\"google map library\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">markercluster</a>這兩個 library，markerwithlabel 讓我們更簡單設計不同的 marker，例如讓他帶自訂的 image，再來是重點 markercluster，它讓我們可以解決 marker 過多，同時重疊的問題。</p>\n<p>首先處理單一個 marker 用的是 MarkerWithLabel，原本呼叫 google.maps.Marker 改成 MarkerWithLabel，然後就搞定了，非常快速簡單，他可以用的 event 滿多的，基本上都可以處理 marker 的互動，甚至也可以像一般的 marker 設定物件上去。</p>\n<pre><code class=\"language-javascript\">//更多變數請點選說明文件，基本上可以用class 搭配 css操作，或是labelStyle 處理icon style\nvar marker = new MarkerWithLabel({\n    draggable: false,\n    raiseOnDrag: false,\n    map: map,\n    labelContent: '&#x3C;span>' + item.name + '&#x3C;br/>' + item.price + '&#x3C;/span>',\n    labelAnchor: new google.maps.Point(40, 32),\n    labelClass: 'labels', // the CSS class for the label\n    labelStyle: { opacity: 1 },\n    position: { lat: item.lat, lng: item.lng },\n    data: 'Go to ' + item.name + '&#x3C;br/> Taxi price: ' + item.price\n});\n</code></pre>\n<h2>實際範例 markerwithlabel</h2>\n<p data-height=\"259\" data-theme-id=\"light\" data-slug-hash=\"eyYVJz\" data-default-tab=\"result\" data-user=\"chu1228\" data-embed-version=\"2\" data-pen-title=\"google map marker cluster (markercluster & markerlabel)\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/chu1228/pen/eyYVJz/\">google map marker cluster (markercluster & markerlabel)</a> by ianchu (<a href=\"https://codepen.io/chu1228\">@chu1228</a>) on <a href=\"https://codepen.io\">CodePen</a>.</p>\n<script async src=\"https://production-assets.codepen.io/assets/embed/ei.js\"></script>\n<p>最後是使用 markercluster 工具，這工具目前還有另一版 markerclusterplus，這邊就只用來一般版來操作。</p>\n<p>markercluster 主要是處理 marker 下完後，call function 渲染畫面，快速的判斷每個 marker 之間是否接近到某個程度，在創造出屬性這區塊的聚合 marker，簡單的就是</p>\n<pre><code class=\"language-javascript\">下 marker -> markerArr.markercluster({})\n</code></pre>\n<p>建立 Cluster 的方法，這個版本無法帶入 className，需要打開.js 檔案，直接在 style.push 區塊修改，我這邊有修改 background-repeat:no-repeat。</p>\n<pre><code class=\"language-javascript\">//arr 是剛剛marker的 array 需要建立帶入 其餘是內建option\nmarkerCluster = new MarkerClusterer(map, arr, {\n    gridSize: 50,\n    maxZoom: 15,\n    zoomOnClick: true,\n    styles: imgArr,\n    imagePath: 'https://googlemaps.github.io/js-marker-clusterer/images/m'\n});\n</code></pre>\n<p>這邊是客製化 Cluster icon 的方法，這個 function 會抓到這個建立中的 cluster 內包含的 marker，會用陣列帶進來，這時候我們就跑迴圈，將 marker 內的資料帶出來，在看你想呈現的方式處理，我這邊是計算裡面的平均價格（這範例下方有 click event 寫法，不過我直接寫進 codepen 導致跑不動)。</p>\n<pre><code class=\"language-javascript\">// 稍微修改 cluster.js的檔案  讓聚合變得更客製化\nMarkerClusterer.prototype.calculator_ = function(markers, numStyles) {\n    //省略\n    var price = 0;\n    for (var i = 0; i &#x3C; markers.length; i++) {\n        price += Number(markers[i].dataPrice);\n    }\n    price = Math.floor(price / count);\n    //省略\n    return {\n        text: count + ' 筆&#x3C;br/>A. NT' + price,\n        index: index\n    };\n};\n</code></pre>\n<h2>實際範例 markercluster</h2>\n<iframe height='350' scrolling='no' title='google map marker cluster (markercluster & markerlabel)' src='//codepen.io/chu1228/embed/opgwQK/?height=313&theme-id=light&default-tab=result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/chu1228/pen/opgwQK/'>google map marker cluster (markercluster & markerlabel)</a> by ianchu (<a href='https://codepen.io/chu1228'>@chu1228</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<p>上面簡單講解一下 google map marker 過多的處理方法，沒想到最麻煩的是寫範例＋建立假資料最耗時間，快寫完剛好看到更新版的...<a href=\"https://gmaps-marker-clusterer.github.io/gmaps-marker-clusterer/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">最新版更新</a>（os:...，為啥跟 github 版本差那麼多...)，\n大家可以直接試用看看，看介紹貌似支援 call option 直接修改 icon 還有增加 className，能直接略過我上面硬改 cluster.js 這段是最好，畢竟改 plugin 缺乏前端最重要的沿用性。</p>\n<p>感謝大家閱讀！！希望能解決 google map 麻煩的 marker 問題，\n一起來讓 google map 好用一點點點點點點點 XD。</p>","frontmatter":{"title":"Google Map marker cluster 標記使用教學","date":"December 11, 2017","description":"google map下多個marker，再搭配marker的event來互動，以下是打開infowindow的運用。markerwithlabel讓我們更簡單設計不同的marker，例如讓他帶自訂的image，再來是重點 markercluster，它讓我們可以解決marker過多，同時重疊的問題。","categories":"javascript","tags":["google_map","javascript"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABPElEQVQY032Qy07DMBBF8/8/xgahKqVAS6nb+jXxM04cx07SmPQhBBuO7uJoNjNzi67hQJCgRyOwVmeGkYCTBAwUATtJQURFKDkSjCrAdwd+FgIap4uUBvVlqzfDSO2azvsp9FMfL32afJhyzvO8ZL5c5ptfZSHfKJaJOhh4JbBj1Ts1iNfCDr6JbRONGkPIv5jzH4oU07kk26eP02q3Xb1snp8Pm81+vf4sy31Z8uPRSFkraYTQQkjOrZLe2qHv53EsYowW1fKkFZIO85rTGmPLqEIHLyrPecuY58xX0HLwUHmAADwZPTq3/Jw0MhorSRklTFsrpFRaN977EHzX9TGmcQyx70IKcVokDcOS69lLHY609mwUhui7eys/lfxPMYxDw1pJBb9uVM65lOKyNcY+37vOt9xKf/gj+RvJ+sSGJN4GAwAAAABJRU5ErkJggg==","aspectRatio":2.361111111111111,"src":"/static/38e7093d0f66fe667f97b987459880ae/ee604/markerconsole.png","srcSet":"/static/38e7093d0f66fe667f97b987459880ae/c972b/markerconsole.png 340w,\n/static/38e7093d0f66fe667f97b987459880ae/27625/markerconsole.png 680w,\n/static/38e7093d0f66fe667f97b987459880ae/ee604/markerconsole.png 800w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"timeToRead":4,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.131Z"}}},"pageContext":{"slug":"/2017-12-mapcluster/","previous":null,"next":{"fields":{"slug":"/2017-12-arrayhandle/"},"frontmatter":{"title":"Javascript Array sort 陣列排序分類處理","tags":["javascript"]}}}},"staticQueryHashes":["1481458783","63159454"]}