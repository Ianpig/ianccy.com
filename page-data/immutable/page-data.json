{"componentChunkName":"component---src-templates-blog-post-js","path":"/immutable/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"f231ecd8-6441-55b2-9643-8df90c1e5bf6","fields":{"slug":"/2020-04-immutable/"},"headings":[{"value":"Immutable mutable data","id":null,"depth":2},{"value":"React Immutable","id":null,"depth":2},{"value":"心得","id":null,"depth":2}],"excerpt":"Immutable 是我想寫很久的主題，前一份工作時，就大大的踩到關於 immutable 的雷，那時候依靠 google 靠解掉這問題，但總該還債的，面試時候也被這個關內給卡到。現代網頁前端不只是要處理畫面更新，更多時間更會處理大量資料處理，不論是重複封裝 \b、更新等等。React 更是把 Imutable…","html":"<p>Immutable 是我想寫很久的主題，前一份工作時，就大大的踩到關於 immutable 的雷，那時候依靠 google 靠解掉這問題，但總該還債的，面試時候也被這個關內給卡到。現代網頁前端不只是要處理畫面更新，更多時間更會處理大量資料處理，不論是重複封裝 \b、更新等等。React 更是把 Imutable 視為重要的開發準則。</p>\n<!--- ![react immutable](../images/immutable.png \"react immutable\") --->\n<h2>Immutable mutable data</h2>\n<p>什麼是 Immutable、mutable，Immutable 稱之不可改變的，mutable 則相反是可以改變的。string、number 都是 immutable 的，簡單講就是不可更改的，舉個例子來說</p>\n<ul>\n<li>string immutable</li>\n</ul>\n<pre><code class=\"language-javascript\">let str = 'Hello, you!!';\nlet ianHello = str;\nianHello += 'ian';\n\n// not changed\nconsole.log(str); // Hello, you!!\nconsole.log(ianHello); // Hello, you!!ian\n</code></pre>\n<p>建立 ianHello 並使用 str 賦值，之後 ianHello 再重新賦值，並不會更動到 str，但 array 就不是這樣了。array 以及 object 使用 call by reference，淺拷貝的做法實現，白話一點講，就是會指導同一個記憶體位置，當你改動資料的時間，是針對指向的那一個記憶體去改，所以才會有連動的狀況。</p>\n<ul>\n<li>array mutable</li>\n</ul>\n<pre><code class=\"language-javascript\">let names = ['ian'];\nlet copyName = names;\ncopyName.push('peter');\n\n// changed\nconsole.log(names); // [ian, peter]\nconsole.log(copyName); // [ian, peter]\n</code></pre>\n<p>舉下方的例子來說，大致邏輯是依賴兩個陣列資料，驅使更新畫面更新的，呈現問題的使用方法是，點擊<code>複製按鈕</code>，同步兩邊的資料，再點擊任意一個清單的刪除，會發現兩邊畫面居然會連動。</p>\n<iframe src=\"//codepen.io/chu1228/embed/wvMaKYw/?height=265&theme-id=light&default-tab=result\" width=\"100%\" height=\"350\"></iframe>\n<p>會產生問題的原因是，第一我複製資料的時候，讓兩個陣列變成指向同一個，所以才會兩邊連動畫面更新。</p>\n<p>這大致上就是簡單的介紹 immutable 跟 mutable。</p>\n<h2>React Immutable</h2>\n<p>React 有提到 state 的更新，都必須要是 immutable，當你有使用到 useState 或是 pureComponent、shouldComponentUpdate，你就會發現問題。下面範例就是 mutable 的更新 state。</p>\n<iframe src=\"https://codesandbox.io/embed/elastic-flower-hlxd6?fontsize=14&hidenavigation=1&theme=dark\" width=\"100%\" height=\"350\"></iframe>\n<ul>\n<li>mutable setState</li>\n</ul>\n<pre><code class=\"language-javascript\">const value = ref.current.value;\nnames.push(value);\nsetNames(names);\n</code></pre>\n<p>結果就是沒辦法觸發 update component，因為 useState 就有自帶了 shallowEqual，同一個記憶體位置去比較有無更新，當然恆等於，所以這個案例，你怎們加入都無法更新畫面。</p>\n<ul>\n<li>immutable setState</li>\n</ul>\n<pre><code class=\"language-javascript\">setNames(names => [...names, value]);\n</code></pre>\n<p><a href=\"https://reactjs.org/docs/optimizing-performance.html#the-power-of-not-mutating-data\" title=\"react optimizing-performance\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">react optimizing-performance</a></p>\n<p><a href=\"https://redux.js.org/recipes/structuring-reducers/beyond-combinereducers#using-slice-reducers-with-immutablejs-objects\" title=\"redux reducers immutablejs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redux reducers immutablejs</a></p>\n<h2>心得</h2>\n<p>記得剛轉前端工作的時候，被這問題卡了一下午，最後是靠 stackoverflow <code>slice</code>，來解決問題。以前遇到問題都是找到解法就結束了，但說實在沒搞懂原因，這樣遲早還是得回頭還債的。</p>\n<p>勉勵一下自己，要求慎解啊！</p>\n<p>一樣有問題、或是錯誤，歡迎留言，感謝閱讀。</p>","frontmatter":{"title":"Immutable 對於 React 重要性","date":"April 29, 2020","description":"React 有提到 state 的更新，都必須要是 immutable，當你有使用到 useState 或是 pureComponent、shouldComponentUpdate，你就會發現問題。","categories":"javascript","tags":["javascript","react.js"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVQY0x2RXWvTYBiG8588V/+AMgVRDxSsIMgOhuIsTjccU/HAEw89FCyCymoH27TVtXZJlzSfzVffZknaNG2apvlo0hZM1w2fCffpdd/X+z4YzTUZHkGOGEUQ0OqL1xeuZK4/eHZzeeP2yqs7j94s3Xtya3n90rXMw6dbSLMqBMsISFQNUdExghIhqtaz3aQ3iAlKKeEir/ZkzaUl60gwGNmSWg5Oo0NKdUeznjvROx7X0BqygbFCi2u0zK4fTc788Ynr/+04Cck0IZxocKJZJaXfVVZGthfNg/FJmJw53hQnG8BjomIArLeHYXI6itKuE+tWUNgtf83/3NmrFHYrH3Pbnz5/L1cZqPbCNIgXABN1sUZLmCDpdVY1Oh4sj6K5PUjasMyiMs4fktKPIsFLZo2SGf7YHy+gHeCBNwNf4DH4MFZAlu2H/7X7wylo75dq2zul/SL+5dverwMyXyge/KGDGNTmAMMATgngi4G6KGnncHK+3HenXScZBmkYn4bJwg1S109HEZTO7MEESHid482KFbJWlzBZ0RVFbyKzdWyDfy6X33z7Prv6eON5dm0tu/ly/UZm5eLS/ctX7269+2C2+yoy4WCSYpCM/A9Q/YAvzRrmgwAAAABJRU5ErkJggg==","aspectRatio":2.446043165467626,"src":"/static/4f1b194d3f394f7e66bb7c726da840eb/ec308/immutable.png","srcSet":"/static/4f1b194d3f394f7e66bb7c726da840eb/c972b/immutable.png 340w,\n/static/4f1b194d3f394f7e66bb7c726da840eb/27625/immutable.png 680w,\n/static/4f1b194d3f394f7e66bb7c726da840eb/ec308/immutable.png 873w","sizes":"(max-width: 873px) 100vw, 873px"}}}},"timeToRead":2,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.156Z"}}},"pageContext":{"slug":"/2020-04-immutable/","previous":{"fields":{"slug":"/2020-02-reactpuppeteer/"},"frontmatter":{"title":"Puppeteer End-to-End Test React","tags":["react.js"]}},"next":{"fields":{"slug":"/2020-06-closure/"},"frontmatter":{"title":"JavaScript Closure 你一定有用過的閉包","tags":["javascript"]}}}},"staticQueryHashes":["1481458783","63159454"]}