{"componentChunkName":"component---src-templates-blog-post-js","path":"/nodestart/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"28c9435c-12ee-51ed-b27e-0e20b1432547","fields":{"slug":"/2018-06-nodestart/"},"headings":[{"value":"express 建立 router","id":"express-建立-router","depth":2},{"value":"串接 MySQL","id":"串接-mysql","depth":2},{"value":"部署 Heroku","id":"部署-heroku","depth":2}],"excerpt":"一個網站組成主要會是前端加後端，簡單來說，前端主要是畫面加上操作介面，包含了 html、css、javascript，後端則是處理使用者請求控制回應，例如登入註冊，會員後台等等，其中後端有各種語言例如 PHP、Java、ASP.NET、Node.js、Python、Ruby…","html":"<p>一個網站組成主要會是前端加後端，簡單來說，前端主要是畫面加上操作介面，包含了 html、css、javascript，後端則是處理使用者請求控制回應，例如登入註冊，會員後台等等，其中後端有各種語言例如 PHP、Java、ASP.NET、Node.js、Python、Ruby…等等。</p>\n<p>在這個前後端分離的時代，多半會再開一台 Node.js 的 server 給前端處理 router，如果有使用到 javascript framework(react、vue、angular)，就會需要 server side render，在這邊一同處理畫面跟資料的渲染，而原本的後端則單純負責 api 建立。</p>\n<p>這邊就要來使用 Node.js 搭配 express 以及 MySQL 來建立簡單的網站 router。</p>\n<!--- ![node.js](../images/node.png \"node.js\") --->\n<h2 id=\"express-建立-router\" style=\"position:relative;\"><a href=\"#express-%E5%BB%BA%E7%AB%8B-router\" aria-label=\"express 建立 router permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>express 建立 router</h2>\n<p>1.首先建立資料夾、建立 package.json</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// create folder and movein create package.json</span>\nmkdir node<span class=\"token operator\">-</span>express\ncd node<span class=\"token operator\">-</span>express\nnpm init <span class=\"token operator\">-</span>y\n\n<span class=\"token comment\">//install express</span>\nnpm install express <span class=\"token operator\">--</span>save</code></pre></div>\n<p>2.建立 app.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// use express method</span>\n<span class=\"token keyword\">var</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// use express get method</span>\n<span class=\"token comment\">// create root router and print hello world</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello world'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// check running enviroment</span>\n<span class=\"token keyword\">var</span> port <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// create</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// only print hint link for local enviroment</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>port <span class=\"token operator\">===</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'RUN http://localhost:3000/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"http://expressjs.com/zh-tw/4x/api.html#app.get.method\" title=\"express get\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express get</a><br>\n<a href=\"http://expressjs.com/zh-tw/4x/api.html#app.listen\" title=\"express listen\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express listen</a><br>\n<a href=\"http://expressjs.com/zh-tw/4x/api.html#app.METHOD\" title=\"express METHOD\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express METHOD</a></p>\n<p>3.執行 app.js、打開 <a href=\"http://localhost:3000/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000/</a><br>\n打開 command 輸入 node app.js 執行檔案</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">node app<span class=\"token punctuation\">.</span>js</code></pre></div>\n<p>\n  <figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/83210/nodehello.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 615px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAAWklEQVQoz+XNOw6AIBAA0b3/+SQhURa73YhAAKGwEIkX8EPp6ycDzExESuE4KUQchJBSzlqv1ro7YJrFEHHechNjTCmVkvcHIITgnW9NfQ9qBzguH+Ou8w/jE25kTa6lEr9cAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/a805d/nodehello.webp 495w,\n/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/3fce0/nodehello.webp 615w\"\n          sizes=\"(max-width: 615px) 100vw, 615px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/b3db0/nodehello.png 495w,\n/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/83210/nodehello.png 615w\"\n          sizes=\"(max-width: 615px) 100vw, 615px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/83210/nodehello.png\"\n          alt=\"node hello world\"\n          title=\"node hello world\"\n          src=\"/static/2c5f0d98b47abe0a9afb7e7305d7b3f3/83210/nodehello.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">node hello world</figcaption>\n  </figure>\n      <br>\n成功看到了 Hello world，這樣就建立了一個很簡易的 node server。但這邊印出來的 hello world，只是純粹字串，不具備 html 架構。</p>\n<p>4.建立對應 html 檔案搭配動態 router</p>\n<p>這邊用到的是 ejs template，方便我們之後取用 node.js 傳遞的資料。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// install ejs</span>\nnpm install ejs<span class=\"token operator\">-</span>locals <span class=\"token operator\">--</span>save</code></pre></div>\n<p>建立 ejs 相對應的檔案。<br>\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8677fc536c06dd2ff9a53ac568370575/acfc1/filestru.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 41.01010101010101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABEklEQVQY042Q22rDMBBE9Su1JEvW1bIuViQ7xgklJXGe+v//0jWGQEsLXQ7zotnRMqjOdTkvQgillNYgyg0uDn6Ow1SKMTbGoI3RymitOe8OwGutReOYH/etlMm5sNN7yrqTdZfY966njBFMMSYNJqCEUEpbUCEV5KKUxtvto5QCYT4E70PL+CDNs8bPbXy/T8sa65LOs8uzDyene2kHDR7IQuBe16uUinMhpZZCkZZF4y65pDH54FNO0XsrBRcdTNsyAP4HUCmnx/ZMudje79ih5V12fp2nWFOutU6LFLpp9puPs18ga3XOGbo63gBYDtY52b2RBjzgxxg3vw1ijDfQxvfIvRVKX3F/gaD3H2v/5wsSSVL5VXyh0AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/8677fc536c06dd2ff9a53ac568370575/a805d/filestru.webp 495w,\n/static/8677fc536c06dd2ff9a53ac568370575/6ec60/filestru.webp 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/8677fc536c06dd2ff9a53ac568370575/b3db0/filestru.png 495w,\n/static/8677fc536c06dd2ff9a53ac568370575/acfc1/filestru.png 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/8677fc536c06dd2ff9a53ac568370575/acfc1/filestru.png\"\n          alt=\"file structure\"\n          title=\"file structure\"\n          src=\"/static/8677fc536c06dd2ff9a53ac568370575/acfc1/filestru.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">file structure</figcaption>\n  </figure>\n      </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// create ejs</span>\n<span class=\"token keyword\">var</span> engine <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ejs-locals'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">engine</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ejs'</span><span class=\"token punctuation\">,</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'files'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'./files'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'view engine'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'ejs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token comment\">// modify router use file name</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/about'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'about'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>輸入完成一樣執行 node app.js，就完成有對應檔案的 router。<br>\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/ef14d/nodedemo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 750px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.18181818181818%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABCklEQVQoz8WNX2+CMBTF+/0/zrI31EZA0Tm3dJkC8meABdrSWzrkeay4hFdjfNgvzc255+b0oNnWesZPczybLxZL295uVssR23Hcl91us9kaH2PseR4hxHEcvMDuav3u2q5lobIso+R08hOffEZRXBVUNUI0DUjZqhYAzCalHEXTyCtGtApAAuovnfFpovpcSNBARS84tFrrltWsriozzV9GxHFSVTXnLC8KznldM/S6f0vTL/JBDkFAKT0cj3meBb4fhuFwCyQk7y5aqkYpUEoxxrpvzRnLs8ycf65MYuJvR/7+HOwLsk5pCsOdIH5uBdVVBlr2Y8PVnQpvhIcHQGPX9O4OP9T8X+FfkieriIWWwXcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/a805d/nodedemo.webp 495w,\n/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/e28c4/nodedemo.webp 750w\"\n          sizes=\"(max-width: 750px) 100vw, 750px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/b3db0/nodedemo.png 495w,\n/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/ef14d/nodedemo.png 750w\"\n          sizes=\"(max-width: 750px) 100vw, 750px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/ef14d/nodedemo.png\"\n          alt=\"nodedemo\"\n          title=\"nodedemo\"\n          src=\"/static/0dad7d0dddbfd90a1c6ef99bb2e9c2c2/ef14d/nodedemo.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">nodedemo</figcaption>\n  </figure>\n      </p>\n<p><a href=\"http://expressjs.com/zh-tw/starter/static-files.html\" title=\"express static\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express static</a></p>\n<h2 id=\"串接-mysql\" style=\"position:relative;\"><a href=\"#%E4%B8%B2%E6%8E%A5-mysql\" aria-label=\"串接 mysql permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>串接 MySQL</h2>\n<p>再來讓我們試著串接 MySQL，做一個完整的後端服務。如果你的電腦沒有安裝 MySQL，要記得先安裝好，<a href=\"https://dev.mysql.com/doc/refman/5.7/en/osx-installation-pkg.html\" title=\"mac 安裝 mysql 教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mac 安裝 mysql 教學</a>、<a href=\"https://jerrynest.io/windows-mysql-installer/\" title=\"windwos 安裝 mysql 教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">windwos 安裝 mysql 教學</a>。<br>\nps.mysql 記得安裝 5.7 以下版本，剛剛跑一遍下載到 8.0.x 版本的，sequel pro 連接出一堆問題，也許是不支援新版的。</p>\n<p>1.安裝 MySQL for node.js</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// install MySQL tool</span>\nnpm install mysql <span class=\"token operator\">--</span>save</code></pre></div>\n<p><a href=\"http://expressjs.com/zh-tw/guide/database-integration.html#mysql\" title=\"express with mysql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express with mysql</a><br>\n<a href=\"https://github.com/mysqljs/mysql\" title=\"node.js mysql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">node.js mysql</a></p>\n<p>2.在 MySQL 建立資料、透過 express 連接 sql<br>\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef4cc874ae00935d8403dd823f77350e/acfc1/sqldata.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.08080808080808%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABBklEQVQY01WOe0vDMBTF8/2/iw/Ef+aoYqu2q2Ak6yvpM32xZevaTuz62MDb6mD+CIdzk3MuQfGarYTYbIoksj3X+rQj5kZ+yJemSU1dVmRCiOM4lNL0gizLhBDId4MlIUEQ4nflUZrdzeRnZaG+qaqmYl26vrnCGHueB33rjG3boIZhoPn97cv8QXuSfM+LeBz6fpomnPOYx3m+Emv41EhZllVVbSfAl7uyKAr0ob5iTSX6Aqbj6Qj3X/t9XdfbsSJg/G6aPM/HQln1fX+6ACVhFDA3oAwa/dB3ExACPTQHoG1b8KDgu/8gn7nUtJlp1btq6AdIdRBupxXdtKv9i47j79P5/ACgIkMIHBDLjQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/ef4cc874ae00935d8403dd823f77350e/a805d/sqldata.webp 495w,\n/static/ef4cc874ae00935d8403dd823f77350e/6ec60/sqldata.webp 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/ef4cc874ae00935d8403dd823f77350e/b3db0/sqldata.png 495w,\n/static/ef4cc874ae00935d8403dd823f77350e/acfc1/sqldata.png 800w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/ef4cc874ae00935d8403dd823f77350e/acfc1/sqldata.png\"\n          alt=\"sqldata\"\n          title=\"sqldata\"\n          src=\"/static/ef4cc874ae00935d8403dd823f77350e/acfc1/sqldata.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">sqldata</figcaption>\n  </figure>\n      <br>\n在剛剛建立的 app.js 上面建立</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">var</span> mysql      <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mysql'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// connect MySQL</span>\n<span class=\"token keyword\">var</span> connection <span class=\"token operator\">=</span> mysql<span class=\"token punctuation\">.</span><span class=\"token function\">createConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  host     <span class=\"token operator\">:</span> <span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span>\n  user     <span class=\"token operator\">:</span> <span class=\"token string\">'root'</span><span class=\"token punctuation\">,</span>\n  password <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  database<span class=\"token operator\">:</span> <span class=\"token string\">'test'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// select MyGuests table and print all colums</span>\nconnection<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">'select * from MyGuests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> rows<span class=\"token punctuation\">,</span> fields</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The solution is: '</span><span class=\"token punctuation\">,</span> rows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>執行 node app.js 會看到印出資料，這樣就成功地在 express 連接到 MySQL 了，接下來就要把這個資料加到 express 的 router 中，讓我們在頁面中可以使用資料</p>\n<p>3.把剛剛 sql 的資料設定到 about page</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// create object</span>\n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nconnection<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">'select * from MyGuests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> rows<span class=\"token punctuation\">,</span> fields</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// set data to object</span>\n    data<span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> rows<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/about'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// add data property to about page</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'about'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>user <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>4.修改 about.ejs 使用設定的 data</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>Name<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>id <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>firstname<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>firstname <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>lastname<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>lastname <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>email<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>email <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>registert date<span class=\"token operator\">:</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span><span class=\"token operator\">-</span> data<span class=\"token punctuation\">.</span>reg_date <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span></code></pre></div>\n<p>5.執行檔案<br>\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 7vw 0;\">\n  \n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f7d2ede723788d1d62973a0f7aeba181/3c52b/expressdata.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 708px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.23232323232323%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABTElEQVQoz5VS7XLCIBDM+7+XfQFtgBAIkA8QkkCCxjpa04uO9ken02Z/MHDccsvdJsboggvOZPaeMZIJWTVF0fd9jHEYhnEcQwivDcSHO7z34xiTEHzbOVVYS2xomkyYgeZ10xhtqqrS2kgp67rWWislCcmqqq6rinNujEkopUpAgkgJiofDPM+3223+HxLGuBQSpWizeQOBD/JPzM+LV8JCzikdY1xV8LtyqUrXOu/DNE2ryTnNOWPpe9p13dr6ScG5gj5KOTw+PK8hCyFgErDCYA4xHhdMp9PpfD6Dis9f8Ox2zqRUCOPtdrfbbTOCMcKMMfDDn79IMCFSLeCMl2Vp9w78UCpFIC4lRohSBl6A52AuCGFIyzJ6uVzuZEx1Y+x+D7LBNK1zvu+D97CHFoLDrHXgNuscGBmOkAC4XhflSWvicfy4K1w7qfkL9oHkKg68zUYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/f7d2ede723788d1d62973a0f7aeba181/a805d/expressdata.webp 495w,\n/static/f7d2ede723788d1d62973a0f7aeba181/765e0/expressdata.webp 708w\"\n          sizes=\"(max-width: 708px) 100vw, 708px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/f7d2ede723788d1d62973a0f7aeba181/b3db0/expressdata.png 495w,\n/static/f7d2ede723788d1d62973a0f7aeba181/3c52b/expressdata.png 708w\"\n          sizes=\"(max-width: 708px) 100vw, 708px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/f7d2ede723788d1d62973a0f7aeba181/3c52b/expressdata.png\"\n          alt=\"expressdata\"\n          title=\"expressdata\"\n          src=\"/static/f7d2ede723788d1d62973a0f7aeba181/3c52b/expressdata.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n  <figcaption class=\"gatsby-resp-image-figcaption\">expressdata</figcaption>\n  </figure>\n      </p>\n<p>會發現到頁面拿到了 MySQL 的資料，這樣就完成了很基本的一個後端架構。</p>\n<p><a href=\"https://github.com/Ianpig/work/tree/nodeexpre\" title=\"source code\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">source code</a></p>\n<h2 id=\"部署-heroku\" style=\"position:relative;\"><a href=\"#%E9%83%A8%E7%BD%B2-heroku\" aria-label=\"部署 heroku permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>部署 Heroku</h2>\n<p>再來把剛剛寫好的 node.js 部署到網路上面，heroku 有免費使用的方案，所以這邊使用的是 heroku。</p>\n<p>首先要安裝 heroku cli，再來註冊帳號，在專案內的 package.json 加入”start”: “node app.js”，新增檔案 Procfile。</p>\n<p><a href=\"https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction\" title=\"heroku node deploy 教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">heroku node deploy 教學</a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// file package.json</span>\n\n  <span class=\"token string\">\"engines\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.2.2\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node app.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token comment\">// file Procfile</span>\nweb<span class=\"token operator\">:</span> node app<span class=\"token punctuation\">.</span>js</code></pre></div>\n<p>開始準備部署作業</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//login account</span>\nheroku login\n\n<span class=\"token comment\">//use git</span>\ngit init\ngit add <span class=\"token punctuation\">.</span>\ngit commit <span class=\"token operator\">-</span>m <span class=\"token string\">\"init node\"</span>\n\n<span class=\"token comment\">// create heroku repo</span>\nheroku create\n\n<span class=\"token comment\">// push remote</span>\ngit push heroku master\n\nheroku ps<span class=\"token operator\">:</span>scale web<span class=\"token operator\">=</span><span class=\"token number\">1</span>\n\nheroku open</code></pre></div>\n<p>完成部署之後就可以看到剛剛的內容了。</p>\n<p>實際上檔案架構應該要分離，這邊為了快速 demo 以及簡單化，所以全部操作都寫在一個檔案，應該要分離 router、MySQL 的邏輯，然後引入其他工具方便我們操作。讓架構比較清楚也比較好管理。日後再好好的處理一版。</p>\n<p>之後應該會考慮用 mongoDB，不用人人本地端要安裝 MySQL。然後寫 api 做出 CRUD，再搭配 node.js 或是 next 做 Server side render。</p>","frontmatter":{"title":"Node.js、Express、MySQL串接資料庫，Heroku部署環境","date":"June 17, 2018","description":"在這個前後端分離的時代，多半會再開一台Node.js的server給前端處理router，這邊就要來使用Node.js搭配express以及MySQL來建立簡單的網站router。","categories":"javascript","tags":["node.js"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABXElEQVQoz5VS2XbCIBDl///L/oALW1hDCIYkJMFqPVbTUU/tQ0979D7AMMw+FynjQqiV1FIYtmaCMm2cV6rv+5zzOI7TNA3D8BBAP96QUkKF7YYhtV20qmloM3jPdBh5UXkf6uCcq+tgjKmqqq5raw2lzLmqck5KiTijnHOrwUBvKM673TzPl8tlfgJIaS2ENNrgDV4s3qDAu/NvzN8fDwOklCo4n3J+PuFPZu99acvYxpSG/X7/mrMry4IXUojNetN13Uv5EQxQSWnhMma8Nzw/7QzL0FrDJuAEeZfz+xX7w+FwPB6hivMfuDqXZSkKYYzFhCyXq9VqySghmAghgA//d4F85Qilxl4hhYRYzTYCH0prKeiNIRhzLoALEA72gjEBM8b46XRCwBVCeO1Ds91C2SGENsbU90NKIMMIgWFNE4FtTYxAZHiCAeDz84xSu2tDfp8+bhW+tKn5Cw7b4FZNq5mkAAAAAElFTkSuQmCC","aspectRatio":1.5813953488372092,"src":"/static/f7d2ede723788d1d62973a0f7aeba181/c87c0/expressdata.png","srcSet":"/static/f7d2ede723788d1d62973a0f7aeba181/c972b/expressdata.png 340w,\n/static/f7d2ede723788d1d62973a0f7aeba181/27625/expressdata.png 680w,\n/static/f7d2ede723788d1d62973a0f7aeba181/c87c0/expressdata.png 708w","sizes":"(max-width: 708px) 100vw, 708px"}}}},"timeToRead":5,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.136Z"}}},"pageContext":{"slug":"/2018-06-nodestart/","previous":{"fields":{"slug":"/2018-05-fbvotify/"},"frontmatter":{"title":"Facebook 粉絲團網域驗證教學","tags":["facebook"]}},"next":{"fields":{"slug":"/2018-06-gautm/"},"frontmatter":{"title":"Google analytics UTM設定參數，追蹤facebook廣告、簡訊、EDM","tags":["google_analytics"]}}}},"staticQueryHashes":["1481458783","63159454"]}