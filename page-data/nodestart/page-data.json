{"componentChunkName":"component---src-templates-blog-post-js","path":"/nodestart/","result":{"data":{"site":{"siteMetadata":{"title":"Ian Chu","author":"Ian Chu","siteUrl":"https://ianccy.com","social":{"facebook":"chu1228"}}},"markdownRemark":{"id":"28c9435c-12ee-51ed-b27e-0e20b1432547","fields":{"slug":"/2018-06-nodestart/"},"headings":[{"value":"express 建立 router","id":null,"depth":2},{"value":"串接 MySQL","id":null,"depth":2},{"value":"部署 Heroku","id":null,"depth":2}],"excerpt":"一個網站組成主要會是前端加後端，簡單來說，前端主要是畫面加上操作介面，包含了 html、css、javascript，後端則是處理使用者請求控制回應，例如登入註冊，會員後台等等，其中後端有各種語言例如 PHP、Java、ASP.NET、Node.js、Python、Ruby…","html":"<p>一個網站組成主要會是前端加後端，簡單來說，前端主要是畫面加上操作介面，包含了 html、css、javascript，後端則是處理使用者請求控制回應，例如登入註冊，會員後台等等，其中後端有各種語言例如 PHP、Java、ASP.NET、Node.js、Python、Ruby...等等。</p>\n<p>在這個前後端分離的時代，多半會再開一台 Node.js 的 server 給前端處理 router，如果有使用到 javascript framework(react、vue、angular)，就會需要 server side render，在這邊一同處理畫面跟資料的渲染，而原本的後端則單純負責 api 建立。</p>\n<p>這邊就要來使用 Node.js 搭配 express 以及 MySQL 來建立簡單的網站 router。</p>\n<!--- ![node.js](../images/node.png \"node.js\") --->\n<h2>express 建立 router</h2>\n<p>1.首先建立資料夾、建立 package.json</p>\n<pre><code class=\"language-javascript\">// create folder and movein create package.json\nmkdir node-express\ncd node-express\nnpm init -y\n\n//install express\nnpm install express --save\n</code></pre>\n<p>2.建立 app.js</p>\n<pre><code class=\"language-javascript\">// use express method\nvar express = require('express');\nvar app = express();\n\n// use express get method\n// create root router and print hello world\napp.get('/', function(req, res) {\n    res.send('hello world');\n});\n\n// check running enviroment\nvar port = process.env.PORT || 3000;\n\n// create\napp.listen(port);\n\n// only print hint link for local enviroment\nif (port === 3000) {\n    console.log('RUN http://localhost:3000/');\n}\n</code></pre>\n<p><a href=\"http://expressjs.com/zh-tw/4x/api.html#app.get.method\" title=\"express get\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express get</a>\n<a href=\"http://expressjs.com/zh-tw/4x/api.html#app.listen\" title=\"express listen\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express listen</a>\n<a href=\"http://expressjs.com/zh-tw/4x/api.html#app.METHOD\" title=\"express METHOD\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express METHOD</a></p>\n<p>3.執行 app.js、打開 <a href=\"http://localhost:3000/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000/</a>\n打開 command 輸入 node app.js 執行檔案</p>\n<pre><code class=\"language-javascript\">node app.js\n</code></pre>\n<p><img src=\"../images/nodehello.png\" alt=\"node hello world\" title=\"node hello world\">\n成功看到了 Hello world，這樣就建立了一個很簡易的 node server。但這邊印出來的 hello world，只是純粹字串，不具備 html 架構。</p>\n<p>4.建立對應 html 檔案搭配動態 router</p>\n<p>這邊用到的是 ejs template，方便我們之後取用 node.js 傳遞的資料。</p>\n<pre><code class=\"language-javascript\">// install ejs\nnpm install ejs-locals --save\n</code></pre>\n<p>建立 ejs 相對應的檔案。\n<img src=\"../images/filestru.png\" alt=\"file structure\" title=\"file structure\"></p>\n<pre><code class=\"language-javascript\">// create ejs\nvar engine = require('ejs-locals');\napp.engine('ejs',engine);\napp.set('files','./files');\napp.set('view engine','ejs');\n\n...\n\n// modify router use file name\napp.get('/', function(req, res){\n  res.render('index');\n});\n\napp.get('/about', function(req, res){\n  res.render('about');\n});\n</code></pre>\n<p>輸入完成一樣執行 node app.js，就完成有對應檔案的 router。\n<img src=\"../images/nodedemo.png\" alt=\"nodedemo\" title=\"nodedemo\"></p>\n<p><a href=\"http://expressjs.com/zh-tw/starter/static-files.html\" title=\"express static\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express static</a></p>\n<h2>串接 MySQL</h2>\n<p>再來讓我們試著串接 MySQL，做一個完整的後端服務。如果你的電腦沒有安裝 MySQL，要記得先安裝好，<a href=\"https://dev.mysql.com/doc/refman/5.7/en/osx-installation-pkg.html\" title=\"mac 安裝 mysql 教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mac 安裝 mysql 教學</a>、<a href=\"https://jerrynest.io/windows-mysql-installer/\" title=\"windwos 安裝 mysql 教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">windwos 安裝 mysql 教學</a>。\nps.mysql 記得安裝 5.7 以下版本，剛剛跑一遍下載到 8.0.x 版本的，sequel pro 連接出一堆問題，也許是不支援新版的。</p>\n<p>1.安裝 MySQL for node.js</p>\n<pre><code class=\"language-javascript\">// install MySQL tool\nnpm install mysql --save\n</code></pre>\n<p><a href=\"http://expressjs.com/zh-tw/guide/database-integration.html#mysql\" title=\"express with mysql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">express with mysql</a>\n<a href=\"https://github.com/mysqljs/mysql\" title=\"node.js mysql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">node.js mysql</a></p>\n<p>2.在 MySQL 建立資料、透過 express 連接 sql\n<img src=\"../images/sqldata.png\" alt=\"sqldata\" title=\"sqldata\">\n在剛剛建立的 app.js 上面建立</p>\n<pre><code class=\"language-javascript\">...\nvar mysql      = require('mysql');\n\n// connect MySQL\nvar connection = mysql.createConnection({\n  host     : 'localhost',\n  user     : 'root',\n  password : '',\n  database: 'test'\n});\n\n// select MyGuests table and print all colums\nconnection.query('select * from MyGuests', function(err, rows, fields) {\n  if (err) throw err;\n  console.log('The solution is: ', rows);\n});\n</code></pre>\n<p>執行 node app.js 會看到印出資料，這樣就成功地在 express 連接到 MySQL 了，接下來就要把這個資料加到 express 的 router 中，讓我們在頁面中可以使用資料</p>\n<p>3.把剛剛 sql 的資料設定到 about page</p>\n<pre><code class=\"language-javascript\">// create object\nvar data = {};\nconnection.query('select * from MyGuests', function(err, rows, fields) {\n    if (err) throw err;\n    // set data to object\n    data.user = rows[0];\n});\n\napp.get('/', function(req, res) {\n    res.render('index');\n});\n\napp.get('/about', function(req, res) {\n    // add data property to about page\n    res.render('about', { data: data.user });\n});\n</code></pre>\n<p>4.修改 about.ejs 使用設定的 data</p>\n<pre><code class=\"language-javascript\">    &#x3C;h2>Name:&#x3C;%- data.id %>&#x3C;/h2>\n    &#x3C;h2>firstname:&#x3C;%- data.firstname %>&#x3C;/h2>\n    &#x3C;h2>lastname:&#x3C;%- data.lastname %>&#x3C;/h2>\n    &#x3C;h2>email:&#x3C;%- data.email %>&#x3C;/h2>\n    &#x3C;h2>registert date:&#x3C;%- data.reg_date %>&#x3C;/h2>\n</code></pre>\n<p>5.執行檔案\n<img src=\"../images/expressdata.png\" alt=\"expressdata\" title=\"expressdata\"></p>\n<p>會發現到頁面拿到了 MySQL 的資料，這樣就完成了很基本的一個後端架構。</p>\n<p><a href=\"https://github.com/Ianpig/work/tree/nodeexpre\" title=\"source code\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">source code</a></p>\n<h2>部署 Heroku</h2>\n<p>再來把剛剛寫好的 node.js 部署到網路上面，heroku 有免費使用的方案，所以這邊使用的是 heroku。</p>\n<p>首先要安裝 heroku cli，再來註冊帳號，在專案內的 package.json 加入\"start\": \"node app.js\"，新增檔案 Procfile。</p>\n<p><a href=\"https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction\" title=\"heroku node deploy 教學\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">heroku node deploy 教學</a></p>\n<pre><code class=\"language-javascript\">// file package.json\n\n  \"engines\": {\n    \"node\": \"6.2.2\"\n  },\n  \"scripts\": {\n    \"start\": \"node app.js\",\n    \"test\": \"echo \\\"Error: no test specified\\\" &#x26;&#x26; exit 1\"\n  },\n\n// file Procfile\nweb: node app.js\n</code></pre>\n<p>開始準備部署作業</p>\n<pre><code class=\"language-javascript\">//login account\nheroku login\n\n//use git\ngit init\ngit add .\ngit commit -m \"init node\"\n\n// create heroku repo\nheroku create\n\n// push remote\ngit push heroku master\n\nheroku ps:scale web=1\n\nheroku open\n</code></pre>\n<p>完成部署之後就可以看到剛剛的內容了。</p>\n<p>實際上檔案架構應該要分離，這邊為了快速 demo 以及簡單化，所以全部操作都寫在一個檔案，應該要分離 router、MySQL 的邏輯，然後引入其他工具方便我們操作。讓架構比較清楚也比較好管理。日後再好好的處理一版。</p>\n<p>之後應該會考慮用 mongoDB，不用人人本地端要安裝 MySQL。然後寫 api 做出 CRUD，再搭配 node.js 或是 next 做 Server side render。</p>","frontmatter":{"title":"Node.js、Express、MySQL串接資料庫，Heroku部署環境","date":"June 17, 2018","description":"在這個前後端分離的時代，多半會再開一台Node.js的server給前端處理router，這邊就要來使用Node.js搭配express以及MySQL來建立簡單的網站router。","categories":"javascript","tags":["node.js"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABXElEQVQoz5VS2XbCIBDl///L/oALW1hDCIYkJMFqPVbTUU/tQ0979D7AMMw+FynjQqiV1FIYtmaCMm2cV6rv+5zzOI7TNA3D8BBAP96QUkKF7YYhtV20qmloM3jPdBh5UXkf6uCcq+tgjKmqqq5raw2lzLmqck5KiTijnHOrwUBvKM673TzPl8tlfgJIaS2ENNrgDV4s3qDAu/NvzN8fDwOklCo4n3J+PuFPZu99acvYxpSG/X7/mrMry4IXUojNetN13Uv5EQxQSWnhMma8Nzw/7QzL0FrDJuAEeZfz+xX7w+FwPB6hivMfuDqXZSkKYYzFhCyXq9VqySghmAghgA//d4F85Qilxl4hhYRYzTYCH0prKeiNIRhzLoALEA72gjEBM8b46XRCwBVCeO1Ds91C2SGENsbU90NKIMMIgWFNE4FtTYxAZHiCAeDz84xSu2tDfp8+bhW+tKn5Cw7b4FZNq5mkAAAAAElFTkSuQmCC","aspectRatio":1.5813953488372092,"src":"/static/f7d2ede723788d1d62973a0f7aeba181/c87c0/expressdata.png","srcSet":"/static/f7d2ede723788d1d62973a0f7aeba181/c972b/expressdata.png 340w,\n/static/f7d2ede723788d1d62973a0f7aeba181/27625/expressdata.png 680w,\n/static/f7d2ede723788d1d62973a0f7aeba181/c87c0/expressdata.png 708w","sizes":"(max-width: 708px) 100vw, 708px"}}}},"timeToRead":4,"parent":{"__typename":"File","modifiedTime":"2021-05-16T08:19:40.136Z"}}},"pageContext":{"slug":"/2018-06-nodestart/","previous":{"fields":{"slug":"/2018-05-fbvotify/"},"frontmatter":{"title":"Facebook 粉絲團網域驗證教學","tags":["facebook"]}},"next":{"fields":{"slug":"/2018-06-gautm/"},"frontmatter":{"title":"Google analytics UTM設定參數，追蹤facebook廣告、簡訊、EDM","tags":["google_analytics"]}}}},"staticQueryHashes":["1481458783","63159454"]}